{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "c6661f4e-0cf7-4317-9cb9-738868a9f8ce",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\geyntd\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\fuzzywuzzy\\fuzz.py:11: UserWarning: Using slow pure-python SequenceMatcher. Install python-Levenshtein to remove this warning\n",
      "  warnings.warn('Using slow pure-python SequenceMatcher. Install python-Levenshtein to remove this warning')\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import re\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "from fuzzywuzzy import process\n",
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.feature_extraction.text import CountVectorizer\n",
    "from sklearn.naive_bayes import MultinomialNB\n",
    "from sklearn.pipeline import make_pipeline\n",
    "from sklearn.metrics import classification_report\n",
    "import numpy as np\n",
    "import joblib\n",
    "\n",
    "import re\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "from sklearn.metrics.pairwise import cosine_similarity\n",
    "from fuzzywuzzy import process"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "c9ad4437-6470-42fc-9a1b-c27f6aece63a",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\geyntd\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\openpyxl\\worksheet\\_read_only.py:85: UserWarning: Data Validation extension is not supported and will be removed\n",
      "  for idx, row in parser.parse():\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Size Cluster</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 30 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "2             NaN  2000023590470  1000499201   \n",
       "3             NaN  3282770074062  1000354605   \n",
       "4             NaN  3282770144659  1000490216   \n",
       "5             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "165           NaN  8700216171748  1000500913   \n",
       "173           NaN  8801046288962  1000543918   \n",
       "174           NaN  8801046866221  1000542602   \n",
       "175           NaN  8801046902233  1000507964   \n",
       "176           NaN  8995151130046  8000038246   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0    VITATEKA Облепиховое масло 180 Алтай Элитное 1...          NaN   \n",
       "2    SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...          NaN   \n",
       "3       KLORANE Кондиционер с экстрактом ромашки 200мл          NaN   \n",
       "4    KLORANE Бальзам Д/Волос Восст с Органич Маслом...          NaN   \n",
       "5    KLORANE Шампунь восст с органич маслом купуасу...          NaN   \n",
       "..                                                 ...          ...   \n",
       "165  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...          NaN   \n",
       "173         KERASYS Шампунь для волос лечение 180мл №1          NaN   \n",
       "174  KERASYS Кондиционер для лечения волос освежающ...          NaN   \n",
       "175   KERASYS Кондиционер для волос Balancing 500мл УЗ          NaN   \n",
       "176  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...          NaN   \n",
       "\n",
       "    4KAM Product Subcategory Usage Price Segment Brand  ... Size Cluster  \\\n",
       "0            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "2            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "3            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "4            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "5            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "..           ...         ...   ...           ...   ...  ...          ...   \n",
       "165          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "173          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "174          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "175          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "176          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "\n",
       "    Qty Washloads Size Concatenate Product line Price SC Promo Type  \\\n",
       "0             NaN              NaN          NaN      NaN        NaN   \n",
       "2             NaN              NaN          NaN      NaN        NaN   \n",
       "3             NaN              NaN          NaN      NaN        NaN   \n",
       "4             NaN              NaN          NaN      NaN        NaN   \n",
       "5             NaN              NaN          NaN      NaN        NaN   \n",
       "..            ...              ...          ...      ...        ...   \n",
       "165           NaN              NaN          NaN      NaN        NaN   \n",
       "173           NaN              NaN          NaN      NaN        NaN   \n",
       "174           NaN              NaN          NaN      NaN        NaN   \n",
       "175           NaN              NaN          NaN      NaN        NaN   \n",
       "176           NaN              NaN          NaN      NaN        NaN   \n",
       "\n",
       "    Promo Details Ignore SKU  isNielsen  New Product  \n",
       "0             NaN        NaN        NaN            1  \n",
       "2             NaN        NaN        NaN            1  \n",
       "3             NaN        NaN        NaN            1  \n",
       "4             NaN        NaN        NaN            1  \n",
       "5             NaN        NaN        NaN            1  \n",
       "..            ...        ...        ...          ...  \n",
       "165           NaN        NaN        NaN            1  \n",
       "173           NaN        NaN        NaN            1  \n",
       "174           NaN        NaN        NaN            1  \n",
       "175           NaN        NaN        NaN            1  \n",
       "176           NaN        NaN        NaN            1  \n",
       "\n",
       "[98 rows x 30 columns]"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_excel(\"магнит еком апрель.xlsx\")\n",
    "df = df[df[\"Import status\"].isna()]\n",
    "df = df[df[\"Ignore SKU\"]!=1]\n",
    "df =df[df[\"4KAM Product\"].isna()]\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "6e4ede8f-4214-48b2-b623-4a8eaf21514f",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = df.dropna(subset = [\"Название PLU\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "f97cb7d2-58c7-452e-b22e-e800deaecae6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['Import status', 'EAN', 'PLU', 'Product Name', '4KAM Product',\n",
       "       'Promo Details', 'Promo Type'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.columns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "efb781cf-0b80-4e5b-af8c-b3dcfdc3766d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Size Cluster</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Treatments</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>VITATEKA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>SYSTEM 4</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BOM</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>None</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>ARAU</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 30 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "2             NaN  2000023590470  1000499201   \n",
       "3             NaN  3282770074062  1000354605   \n",
       "4             NaN  3282770144659  1000490216   \n",
       "5             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "165           NaN  8700216171748  1000500913   \n",
       "173           NaN  8801046288962  1000543918   \n",
       "174           NaN  8801046866221  1000542602   \n",
       "175           NaN  8801046902233  1000507964   \n",
       "176           NaN  8995151130046  8000038246   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0    VITATEKA Облепиховое масло 180 Алтай Элитное 1...          NaN   \n",
       "2    SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...          NaN   \n",
       "3       KLORANE Кондиционер с экстрактом ромашки 200мл          NaN   \n",
       "4    KLORANE Бальзам Д/Волос Восст с Органич Маслом...          NaN   \n",
       "5    KLORANE Шампунь восст с органич маслом купуасу...          NaN   \n",
       "..                                                 ...          ...   \n",
       "165  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...          NaN   \n",
       "173         KERASYS Шампунь для волос лечение 180мл №1          NaN   \n",
       "174  KERASYS Кондиционер для лечения волос освежающ...          NaN   \n",
       "175   KERASYS Кондиционер для волос Balancing 500мл УЗ          NaN   \n",
       "176  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...          NaN   \n",
       "\n",
       "    4KAM Product   Subcategory Usage Price Segment     Brand  ...  \\\n",
       "0            NaN    Treatments   NaN           NaN  VITATEKA  ...   \n",
       "2            NaN  Conditioners   NaN           NaN  SYSTEM 4  ...   \n",
       "3            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "4            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "5            NaN       Shampoo   NaN           NaN   KLORANE  ...   \n",
       "..           ...           ...   ...           ...       ...  ...   \n",
       "165          NaN           BOM   NaN           NaN      None  ...   \n",
       "173          NaN       Shampoo   NaN           NaN   Kerasys  ...   \n",
       "174          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "175          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "176          NaN       Shampoo   NaN           NaN      ARAU  ...   \n",
       "\n",
       "    Size Cluster Qty Washloads Size Concatenate Product line Price SC  \\\n",
       "0            NaN           NaN              NaN          NaN      NaN   \n",
       "2            NaN           NaN              NaN          NaN      NaN   \n",
       "3            NaN           NaN              NaN          NaN      NaN   \n",
       "4            NaN           NaN              NaN          NaN      NaN   \n",
       "5            NaN           NaN              NaN          NaN      NaN   \n",
       "..           ...           ...              ...          ...      ...   \n",
       "165          NaN           NaN              NaN          NaN      NaN   \n",
       "173          NaN           NaN              NaN          NaN      NaN   \n",
       "174          NaN           NaN              NaN          NaN      NaN   \n",
       "175          NaN           NaN              NaN          NaN      NaN   \n",
       "176          NaN           NaN              NaN          NaN      NaN   \n",
       "\n",
       "    Promo Type Promo Details Ignore SKU  isNielsen  New Product  \n",
       "0          NaN           NaN        NaN        NaN            1  \n",
       "2          NaN           NaN        NaN        NaN            1  \n",
       "3          NaN           NaN        NaN        NaN            1  \n",
       "4          NaN           NaN        NaN        NaN            1  \n",
       "5          NaN           NaN        NaN        NaN            1  \n",
       "..         ...           ...        ...        ...          ...  \n",
       "165        NaN           NaN        NaN        NaN            1  \n",
       "173        NaN           NaN        NaN        NaN            1  \n",
       "174        NaN           NaN        NaN        NaN            1  \n",
       "175        NaN           NaN        NaN        NaN            1  \n",
       "176        NaN           NaN        NaN        NaN            1  \n",
       "\n",
       "[98 rows x 30 columns]"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "#import joblib\n",
    "\n",
    "# Функция предсказания с учетом неопределенности\n",
    "def predict_subcategory(product_name, threshold=0.3):\n",
    "    loaded_model = joblib.load('product_classifier_xgb.pkl')\n",
    "    \n",
    "    # Получаем вероятности для каждого класса\n",
    "    probabilities = loaded_model.predict_proba([product_name])\n",
    "    max_probability = np.max(probabilities)\n",
    "\n",
    "    # Получаем предсказанную подкатегорию\n",
    "    predicted_class = loaded_model.predict([product_name])[0]\n",
    "\n",
    "    # Проверяем вероятность\n",
    "    if max_probability < threshold:\n",
    "        return \"хз\"\n",
    "    else:\n",
    "        return predicted_class\n",
    "\n",
    "# Заполнение пустых значений в столбце Subcategory\n",
    "df[\"Subcategory\"] = df.apply(\n",
    "    lambda row: predict_subcategory(row[\"Product Name\"]) if pd.isna(row[\"Subcategory\"]) else row[\"Subcategory\"],\n",
    "    axis=1)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "70a0f341-d33e-4776-b017-2ac1d42f6206",
   "metadata": {},
   "outputs": [],
   "source": [
    "df.to_excel(\"подкатегория орига.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "id": "d95f1a1f-425a-4fc6-b24b-f3c8251cfebe",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Подкатегория для 'Pantene бальзам-маска для влос 350 мл': Conditioners\n"
     ]
    }
   ],
   "source": [
    "new_product_name = \"Pantene бальзам-маска для влос 350 мл\"\n",
    "predicted_subcategory = predict_subcategory(new_product_name, 0.2)\n",
    "print(f\"Подкатегория для '{new_product_name}': {predicted_subcategory}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "cb0266ec-45cb-497e-b2ce-ef2e8b2b05b1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "      <th>Category</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Treatments</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>VITATEKA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>SYSTEM 4</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BOM</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>None</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>ARAU</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 31 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "2             NaN  2000023590470  1000499201   \n",
       "3             NaN  3282770074062  1000354605   \n",
       "4             NaN  3282770144659  1000490216   \n",
       "5             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "165           NaN  8700216171748  1000500913   \n",
       "173           NaN  8801046288962  1000543918   \n",
       "174           NaN  8801046866221  1000542602   \n",
       "175           NaN  8801046902233  1000507964   \n",
       "176           NaN  8995151130046  8000038246   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0    VITATEKA Облепиховое масло 180 Алтай Элитное 1...          NaN   \n",
       "2    SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...          NaN   \n",
       "3       KLORANE Кондиционер с экстрактом ромашки 200мл          NaN   \n",
       "4    KLORANE Бальзам Д/Волос Восст с Органич Маслом...          NaN   \n",
       "5    KLORANE Шампунь восст с органич маслом купуасу...          NaN   \n",
       "..                                                 ...          ...   \n",
       "165  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...          NaN   \n",
       "173         KERASYS Шампунь для волос лечение 180мл №1          NaN   \n",
       "174  KERASYS Кондиционер для лечения волос освежающ...          NaN   \n",
       "175   KERASYS Кондиционер для волос Balancing 500мл УЗ          NaN   \n",
       "176  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...          NaN   \n",
       "\n",
       "    4KAM Product   Subcategory Usage Price Segment     Brand  ...  \\\n",
       "0            NaN    Treatments   NaN           NaN  VITATEKA  ...   \n",
       "2            NaN  Conditioners   NaN           NaN  SYSTEM 4  ...   \n",
       "3            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "4            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "5            NaN       Shampoo   NaN           NaN   KLORANE  ...   \n",
       "..           ...           ...   ...           ...       ...  ...   \n",
       "165          NaN           BOM   NaN           NaN      None  ...   \n",
       "173          NaN       Shampoo   NaN           NaN   Kerasys  ...   \n",
       "174          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "175          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "176          NaN       Shampoo   NaN           NaN      ARAU  ...   \n",
       "\n",
       "    Qty Washloads Size Concatenate Product line Price SC Promo Type  \\\n",
       "0             NaN              NaN          NaN      NaN        NaN   \n",
       "2             NaN              NaN          NaN      NaN        NaN   \n",
       "3             NaN              NaN          NaN      NaN        NaN   \n",
       "4             NaN              NaN          NaN      NaN        NaN   \n",
       "5             NaN              NaN          NaN      NaN        NaN   \n",
       "..            ...              ...          ...      ...        ...   \n",
       "165           NaN              NaN          NaN      NaN        NaN   \n",
       "173           NaN              NaN          NaN      NaN        NaN   \n",
       "174           NaN              NaN          NaN      NaN        NaN   \n",
       "175           NaN              NaN          NaN      NaN        NaN   \n",
       "176           NaN              NaN          NaN      NaN        NaN   \n",
       "\n",
       "    Promo Details Ignore SKU isNielsen  New Product   Category  \n",
       "0             NaN        NaN       NaN            1  Hair care  \n",
       "2             NaN        NaN       NaN            1  Hair care  \n",
       "3             NaN        NaN       NaN            1  Hair care  \n",
       "4             NaN        NaN       NaN            1  Hair care  \n",
       "5             NaN        NaN       NaN            1  Hair care  \n",
       "..            ...        ...       ...          ...        ...  \n",
       "165           NaN        NaN       NaN            1        NaN  \n",
       "173           NaN        NaN       NaN            1  Hair care  \n",
       "174           NaN        NaN       NaN            1  Hair care  \n",
       "175           NaN        NaN       NaN            1  Hair care  \n",
       "176           NaN        NaN       NaN            1  Hair care  \n",
       "\n",
       "[98 rows x 31 columns]"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df[\"Category\"] = df[\"Subcategory\"].apply(lambda x: \"Coloration\" if x in [\"Permanent\", \"Semi-permanent\", \"Natural\", \"Brow\"] else \"Styling\" if x in \n",
    "                                         [\"Modeling\", \"Laquer\", \"Foams\", \"Liquids\", \"Modelling\", \"Styling\"] else \"Hair care\" if \n",
    "                                         x in [\"Conditioners\", \"Shampoo\", \"Treatments\", \"Dry Shampoo\"] else \"Deodorants\" if x in \n",
    "                                         [\"Deodorant\", \"Antipersperant\"] else \n",
    "                                         \"Душ\" if x in [\"Shower Gel\", \"Bath B\"] else np.nan)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "5ac396c5-9609-4228-93d1-4adf1a71b455",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "      <th>Category</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Treatments</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>VITATEKA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>SYSTEM 4</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BOM</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>None</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>ARAU</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 31 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "2             NaN  2000023590470  1000499201   \n",
       "3             NaN  3282770074062  1000354605   \n",
       "4             NaN  3282770144659  1000490216   \n",
       "5             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "165           NaN  8700216171748  1000500913   \n",
       "173           NaN  8801046288962  1000543918   \n",
       "174           NaN  8801046866221  1000542602   \n",
       "175           NaN  8801046902233  1000507964   \n",
       "176           NaN  8995151130046  8000038246   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0    VITATEKA Облепиховое масло 180 Алтай Элитное 1...          NaN   \n",
       "2    SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...          NaN   \n",
       "3       KLORANE Кондиционер с экстрактом ромашки 200мл          NaN   \n",
       "4    KLORANE Бальзам Д/Волос Восст с Органич Маслом...          NaN   \n",
       "5    KLORANE Шампунь восст с органич маслом купуасу...          NaN   \n",
       "..                                                 ...          ...   \n",
       "165  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...          NaN   \n",
       "173         KERASYS Шампунь для волос лечение 180мл №1          NaN   \n",
       "174  KERASYS Кондиционер для лечения волос освежающ...          NaN   \n",
       "175   KERASYS Кондиционер для волос Balancing 500мл УЗ          NaN   \n",
       "176  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...          NaN   \n",
       "\n",
       "    4KAM Product   Subcategory Usage Price Segment     Brand  ...  \\\n",
       "0            NaN    Treatments   NaN           NaN  VITATEKA  ...   \n",
       "2            NaN  Conditioners   NaN           NaN  SYSTEM 4  ...   \n",
       "3            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "4            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "5            NaN       Shampoo   NaN           NaN   KLORANE  ...   \n",
       "..           ...           ...   ...           ...       ...  ...   \n",
       "165          NaN           BOM   NaN           NaN      None  ...   \n",
       "173          NaN       Shampoo   NaN           NaN   Kerasys  ...   \n",
       "174          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "175          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "176          NaN       Shampoo   NaN           NaN      ARAU  ...   \n",
       "\n",
       "    Qty Washloads Size Concatenate Product line Price SC Promo Type  \\\n",
       "0             NaN              NaN          NaN      NaN        NaN   \n",
       "2             NaN              NaN          NaN      NaN        NaN   \n",
       "3             NaN              NaN          NaN      NaN        NaN   \n",
       "4             NaN              NaN          NaN      NaN        NaN   \n",
       "5             NaN              NaN          NaN      NaN        NaN   \n",
       "..            ...              ...          ...      ...        ...   \n",
       "165           NaN              NaN          NaN      NaN        NaN   \n",
       "173           NaN              NaN          NaN      NaN        NaN   \n",
       "174           NaN              NaN          NaN      NaN        NaN   \n",
       "175           NaN              NaN          NaN      NaN        NaN   \n",
       "176           NaN              NaN          NaN      NaN        NaN   \n",
       "\n",
       "    Promo Details Ignore SKU isNielsen  New Product   Category  \n",
       "0             NaN        NaN       NaN            1  Hair care  \n",
       "2             NaN        NaN       NaN            1  Hair care  \n",
       "3             NaN        NaN       NaN            1  Hair care  \n",
       "4             NaN        NaN       NaN            1  Hair care  \n",
       "5             NaN        NaN       NaN            1  Hair care  \n",
       "..            ...        ...       ...          ...        ...  \n",
       "165           NaN        NaN       NaN            1        NaN  \n",
       "173           NaN        NaN       NaN            1  Hair care  \n",
       "174           NaN        NaN       NaN            1  Hair care  \n",
       "175           NaN        NaN       NaN            1  Hair care  \n",
       "176           NaN        NaN       NaN            1  Hair care  \n",
       "\n",
       "[98 rows x 31 columns]"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import re\n",
    "import numpy as np\n",
    "\n",
    "def size(product_name):\n",
    "    p0 = r\"0,[0-9]+\"  # дробь\n",
    "    p6 = r\"[0-9]+[*][0-9]+\"  # n*m\n",
    "    p8 = r\"[0-9]+[x][0-9]+\"  # n*m x - лат\n",
    "    p9 = r\"[0-9]+[х][0-9]+\"  # n*m х - рус\n",
    "    \n",
    "    p = r\"([0-9]+)\\s*мл\" \n",
    "    p1 = r\"([0-9]+)s*м\"\n",
    "    p2 = r\"([0-9]+)\\s*л\"\n",
    "    p3 = r\"([0-9]+)s*ml\"\n",
    "    p4 = r\"([0-9]+)s*m\"\n",
    "    p5 = r\"([0-9]+)\\s*МЛ\"\n",
    "    p7 = r\"([0-9]+)s*гр*\"  # г/гр\n",
    "    p8 = r\"([0-9]+)s*Г\" \n",
    "    #p9 = r\"[0-9]+\"\n",
    "    \n",
    "    if re.findall(p0, product_name):\n",
    "        value = float(re.findall(p0, product_name)[0].replace(\",\", '.')) * 1000\n",
    "    elif re.findall(p6, product_name):\n",
    "        return re.findall(p6, product_name)[0]\n",
    "    elif re.findall(p8, product_name):  # лат\n",
    "        return re.findall(p8, product_name)[0]\n",
    "    elif re.findall(p, product_name):\n",
    "        value = int(re.findall(p, product_name)[0])\n",
    "    elif re.findall(p1, product_name):\n",
    "        value = int(re.findall(p1, product_name)[0])\n",
    "    elif re.findall(p2, product_name):\n",
    "        value = int(re.findall(p2, product_name)[0]) * 1000\n",
    "    elif re.findall(p3, product_name):\n",
    "        value = int(re.findall(p3, product_name)[0])\n",
    "    elif re.findall(p4, product_name):\n",
    "        value = int(re.findall(p4, product_name)[0])\n",
    "    elif re.findall(p5, product_name):\n",
    "        value = int(re.findall(p5, product_name)[0])\n",
    "    elif re.findall(p7, product_name):\n",
    "        value = int(re.findall(p7, product_name)[0])\n",
    "    elif re.findall(p8, product_name):\n",
    "        value = int(re.findall(p8, product_name)[0])\n",
    "    else:\n",
    "        return None\n",
    "\n",
    "    # Проверка на превышение 2000\n",
    "    if int(value) > 2000:\n",
    "        return np.nan\n",
    "    \n",
    "    return value\n",
    "\n",
    "df[\"Size\"] = df[\"Product Name\"].apply(size)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "26c46d02-7ca1-485d-a319-2d6c91e7885b",
   "metadata": {},
   "outputs": [],
   "source": [
    "df.to_excel(\"сайз.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "a665537c-01ed-456d-a726-2cf04e60bd2b",
   "metadata": {},
   "outputs": [],
   "source": [
    "df['Size'] = pd.to_numeric(df['Size'], errors='coerce')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "99cbf175-895d-4eeb-9ebd-45bd27e8a540",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "      <th>Category</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Treatments</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>VITATEKA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>SYSTEM 4</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BOM</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>None</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>ARAU</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 31 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "2             NaN  2000023590470  1000499201   \n",
       "3             NaN  3282770074062  1000354605   \n",
       "4             NaN  3282770144659  1000490216   \n",
       "5             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "165           NaN  8700216171748  1000500913   \n",
       "173           NaN  8801046288962  1000543918   \n",
       "174           NaN  8801046866221  1000542602   \n",
       "175           NaN  8801046902233  1000507964   \n",
       "176           NaN  8995151130046  8000038246   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0    VITATEKA Облепиховое масло 180 Алтай Элитное 1...          NaN   \n",
       "2    SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...          NaN   \n",
       "3       KLORANE Кондиционер с экстрактом ромашки 200мл          NaN   \n",
       "4    KLORANE Бальзам Д/Волос Восст с Органич Маслом...          NaN   \n",
       "5    KLORANE Шампунь восст с органич маслом купуасу...          NaN   \n",
       "..                                                 ...          ...   \n",
       "165  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...          NaN   \n",
       "173         KERASYS Шампунь для волос лечение 180мл №1          NaN   \n",
       "174  KERASYS Кондиционер для лечения волос освежающ...          NaN   \n",
       "175   KERASYS Кондиционер для волос Balancing 500мл УЗ          NaN   \n",
       "176  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...          NaN   \n",
       "\n",
       "    4KAM Product   Subcategory Usage Price Segment     Brand  ...  \\\n",
       "0            NaN    Treatments   NaN           NaN  VITATEKA  ...   \n",
       "2            NaN  Conditioners   NaN           NaN  SYSTEM 4  ...   \n",
       "3            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "4            NaN  Conditioners   NaN           NaN   KLORANE  ...   \n",
       "5            NaN       Shampoo   NaN           NaN   KLORANE  ...   \n",
       "..           ...           ...   ...           ...       ...  ...   \n",
       "165          NaN           BOM   NaN           NaN      None  ...   \n",
       "173          NaN       Shampoo   NaN           NaN   Kerasys  ...   \n",
       "174          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "175          NaN  Conditioners   NaN           NaN   Kerasys  ...   \n",
       "176          NaN       Shampoo   NaN           NaN      ARAU  ...   \n",
       "\n",
       "    Qty Washloads Size Concatenate Product line Price SC Promo Type  \\\n",
       "0             NaN              NaN          NaN      NaN        NaN   \n",
       "2             NaN              NaN          NaN      NaN        NaN   \n",
       "3             NaN              NaN          NaN      NaN        NaN   \n",
       "4             NaN              NaN          NaN      NaN        NaN   \n",
       "5             NaN              NaN          NaN      NaN        NaN   \n",
       "..            ...              ...          ...      ...        ...   \n",
       "165           NaN              NaN          NaN      NaN        NaN   \n",
       "173           NaN              NaN          NaN      NaN        NaN   \n",
       "174           NaN              NaN          NaN      NaN        NaN   \n",
       "175           NaN              NaN          NaN      NaN        NaN   \n",
       "176           NaN              NaN          NaN      NaN        NaN   \n",
       "\n",
       "    Promo Details Ignore SKU isNielsen  New Product   Category  \n",
       "0             NaN        NaN       NaN            1  Hair care  \n",
       "2             NaN        NaN       NaN            1  Hair care  \n",
       "3             NaN        NaN       NaN            1  Hair care  \n",
       "4             NaN        NaN       NaN            1  Hair care  \n",
       "5             NaN        NaN       NaN            1  Hair care  \n",
       "..            ...        ...       ...          ...        ...  \n",
       "165           NaN        NaN       NaN            1        NaN  \n",
       "173           NaN        NaN       NaN            1  Hair care  \n",
       "174           NaN        NaN       NaN            1  Hair care  \n",
       "175           NaN        NaN       NaN            1  Hair care  \n",
       "176           NaN        NaN       NaN            1  Hair care  \n",
       "\n",
       "[98 rows x 31 columns]"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def categorize_size(category, size):\n",
    "    if size:\n",
    "        if category == \"Hair care\":\n",
    "            if size < 200:\n",
    "                return '<199'\n",
    "            elif 200 <= size <= 250:\n",
    "                return '200-250'\n",
    "            elif 251 <= size <= 400:\n",
    "                return '251-400'\n",
    "            elif 401 <= size <= 500:\n",
    "                return '401-500'\n",
    "            elif 501 <= size <= 999:\n",
    "                return '501-999'\n",
    "            elif size >= 1000:\n",
    "                return '>1000'\n",
    "            else:\n",
    "                return None\n",
    "        elif category == \"Styling\":\n",
    "            if size < 150:\n",
    "                return '0-149'\n",
    "            elif 150 <= size <= 200:\n",
    "                return '150-200'\n",
    "            elif 201 <= size <= 300:\n",
    "                return '201-300'\n",
    "            elif size >= 301:\n",
    "                return '301+'\n",
    "            else:\n",
    "                return None\n",
    "        elif category == \"Душ\":\n",
    "            if size <= 100:\n",
    "                return '0-100'\n",
    "            elif 101 <= size <= 250:\n",
    "                return '101-250'\n",
    "            elif 251 <= size <= 500:\n",
    "                return '251-500'\n",
    "            elif 501 <= size <= 750:\n",
    "                return '501-750'\n",
    "            elif size > 750:\n",
    "                return '750+'\n",
    "            else:\n",
    "                return None\n",
    "    \n",
    "        elif category == \"Deodorants\":\n",
    "            if size <= 50:\n",
    "                return '0-50'\n",
    "            elif 51 <= size <= 100:\n",
    "                return '51-100'\n",
    "            elif 101 <= size <= 150:\n",
    "                return '101-150'\n",
    "            elif size >= 151:\n",
    "                return '151+'\n",
    "            else:\n",
    "                return None      \n",
    "        else:\n",
    "            return None\n",
    "    else:\n",
    "        return None\n",
    "# Применение функции к колонке SizeForTons и создание новой колонки Size Cluster\n",
    "df['Size Cluster'] = df.apply(lambda row: categorize_size(row['Category'], row['Size']), axis=1)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "9518d1b9-1311-41bc-9ecb-e9201e41ad04",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Бренд</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Шаума</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Velutte</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>One4me</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>СЬЁСС</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Тафт</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1022</th>\n",
       "      <td>Тресемме</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1023</th>\n",
       "      <td>Нивея</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1024</th>\n",
       "      <td>Дав</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1025</th>\n",
       "      <td>Клиар</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1026</th>\n",
       "      <td>Рексона</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1027 rows × 1 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "         Бренд\n",
       "0        Шаума\n",
       "1      Velutte\n",
       "2       One4me\n",
       "3        СЬЁСС\n",
       "4         Тафт\n",
       "...        ...\n",
       "1022  Тресемме\n",
       "1023     Нивея\n",
       "1024       Дав\n",
       "1025     Клиар\n",
       "1026   Рексона\n",
       "\n",
       "[1027 rows x 1 columns]"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "brand = pd.read_excel(\"бренды март.xlsx\")\n",
    "#brand = brand.rename(columns = {0: \"Brand\"})\n",
    "brand"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "7fc4e7e9-9882-4ed3-a7e8-80800ed06f91",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Size Cluster</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>VITATEKA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>SYSTEM 4</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>None</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>ARAU</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 30 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "2             NaN  2000023590470  1000499201   \n",
       "3             NaN  3282770074062  1000354605   \n",
       "4             NaN  3282770144659  1000490216   \n",
       "5             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "165           NaN  8700216171748  1000500913   \n",
       "173           NaN  8801046288962  1000543918   \n",
       "174           NaN  8801046866221  1000542602   \n",
       "175           NaN  8801046902233  1000507964   \n",
       "176           NaN  8995151130046  8000038246   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0    VITATEKA Облепиховое масло 180 Алтай Элитное 1...          NaN   \n",
       "2    SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...          NaN   \n",
       "3       KLORANE Кондиционер с экстрактом ромашки 200мл          NaN   \n",
       "4    KLORANE Бальзам Д/Волос Восст с Органич Маслом...          NaN   \n",
       "5    KLORANE Шампунь восст с органич маслом купуасу...          NaN   \n",
       "..                                                 ...          ...   \n",
       "165  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...          NaN   \n",
       "173         KERASYS Шампунь для волос лечение 180мл №1          NaN   \n",
       "174  KERASYS Кондиционер для лечения волос освежающ...          NaN   \n",
       "175   KERASYS Кондиционер для волос Balancing 500мл УЗ          NaN   \n",
       "176  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...          NaN   \n",
       "\n",
       "    4KAM Product Subcategory Usage Price Segment     Brand  ... Size Cluster  \\\n",
       "0            NaN         NaN   NaN           NaN  VITATEKA  ...          NaN   \n",
       "2            NaN         NaN   NaN           NaN  SYSTEM 4  ...          NaN   \n",
       "3            NaN         NaN   NaN           NaN   KLORANE  ...          NaN   \n",
       "4            NaN         NaN   NaN           NaN   KLORANE  ...          NaN   \n",
       "5            NaN         NaN   NaN           NaN   KLORANE  ...          NaN   \n",
       "..           ...         ...   ...           ...       ...  ...          ...   \n",
       "165          NaN         NaN   NaN           NaN      None  ...          NaN   \n",
       "173          NaN         NaN   NaN           NaN   Kerasys  ...          NaN   \n",
       "174          NaN         NaN   NaN           NaN   Kerasys  ...          NaN   \n",
       "175          NaN         NaN   NaN           NaN   Kerasys  ...          NaN   \n",
       "176          NaN         NaN   NaN           NaN      ARAU  ...          NaN   \n",
       "\n",
       "    Qty Washloads Size Concatenate Product line Price SC Promo Type  \\\n",
       "0             NaN              NaN          NaN      NaN        NaN   \n",
       "2             NaN              NaN          NaN      NaN        NaN   \n",
       "3             NaN              NaN          NaN      NaN        NaN   \n",
       "4             NaN              NaN          NaN      NaN        NaN   \n",
       "5             NaN              NaN          NaN      NaN        NaN   \n",
       "..            ...              ...          ...      ...        ...   \n",
       "165           NaN              NaN          NaN      NaN        NaN   \n",
       "173           NaN              NaN          NaN      NaN        NaN   \n",
       "174           NaN              NaN          NaN      NaN        NaN   \n",
       "175           NaN              NaN          NaN      NaN        NaN   \n",
       "176           NaN              NaN          NaN      NaN        NaN   \n",
       "\n",
       "    Promo Details Ignore SKU  isNielsen  New Product  \n",
       "0             NaN        NaN        NaN            1  \n",
       "2             NaN        NaN        NaN            1  \n",
       "3             NaN        NaN        NaN            1  \n",
       "4             NaN        NaN        NaN            1  \n",
       "5             NaN        NaN        NaN            1  \n",
       "..            ...        ...        ...          ...  \n",
       "165           NaN        NaN        NaN            1  \n",
       "173           NaN        NaN        NaN            1  \n",
       "174           NaN        NaN        NaN            1  \n",
       "175           NaN        NaN        NaN            1  \n",
       "176           NaN        NaN        NaN            1  \n",
       "\n",
       "[98 rows x 30 columns]"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def find_best_brand(product_name, brands, threshold=60):\n",
    "    # выделение части ноименования с брендом\n",
    "    temp = product_name.split()\n",
    "    product_name = \" \".join(temp[0:2])\n",
    "    best_match = process.extractOne(product_name, brands)\n",
    "    #print(best_match)\n",
    "    if best_match and best_match[1] >= threshold:  # Проверяем, что сходство выше порога\n",
    "        return best_match[0]  # Возвращаем только название бренда\n",
    "    return None  # Возвращаем None, если сходство ниже порога\n",
    "\n",
    "# Применяем функцию к каждому продукту\n",
    "df['Brand'] = df['Product Name'].apply(lambda x: find_best_brand(x, brand['Бренд'].tolist()))\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "cd4d411a-4bf6-4359-80e0-611c55bb325e",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'ROSE Of'"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "s = \"ROSE Of Bulgaria Кондиционер д/Волос 330мл\"\n",
    "\" \".join(s.split()[0:2])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "8f694899-1554-42dd-ba98-efa94fd1f2fa",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Size Cluster</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>14606677146725</td>\n",
       "      <td>1000502755</td>\n",
       "      <td>НАША МАМА Пена д/ванны детская 400мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Шаума</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770039139</td>\n",
       "      <td>1000490250</td>\n",
       "      <td>KLORANE Шампунь с Органич Экстрактом Льняного ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144741</td>\n",
       "      <td>1000490241</td>\n",
       "      <td>KLORANE Шампунь Восстанав с Органич Маслом Куп...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144871</td>\n",
       "      <td>1000490209</td>\n",
       "      <td>KLORANE Детокс-Шампунь с Органич Экстракт Водн...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770392401</td>\n",
       "      <td>1000353431</td>\n",
       "      <td>DUCRAY KELUAL DS Гель смягч пенящийся от раздр...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>DUCRAY</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>172</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8714100706084</td>\n",
       "      <td>1000170477</td>\n",
       "      <td>DOVE Антиперспирант аэрозольМягкостьХлопка150м...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Dove</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8720633002777</td>\n",
       "      <td>1000523601</td>\n",
       "      <td>REXONA Антиперспирант спрей жен Красота 150мл: 12</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Rexona</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8857106890019</td>\n",
       "      <td>1000483752</td>\n",
       "      <td>JINDA Шампунь Травяной 250мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>JINDA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8857106890026</td>\n",
       "      <td>1000483764</td>\n",
       "      <td>JINDA Кондиционер Для Волос Травяной 250мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>JINDA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>177</th>\n",
       "      <td>NaN</td>\n",
       "      <td>PSEUDOBARCODE</td>\n",
       "      <td>1109100001</td>\n",
       "      <td>МОЕ СОЛНЫШКО (м) шампунь леденец/мандарин (Ава...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Мое солнышко</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>152 rows × 30 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status             EAN         PLU  \\\n",
       "0             NaN  14606677146725  1000502755   \n",
       "1             NaN   3282770039139  1000490250   \n",
       "2             NaN   3282770144741  1000490241   \n",
       "3             NaN   3282770144871  1000490209   \n",
       "4             NaN   3282770392401  1000353431   \n",
       "..            ...             ...         ...   \n",
       "172           NaN   8714100706084  1000170477   \n",
       "173           NaN   8720633002777  1000523601   \n",
       "174           NaN   8857106890019  1000483752   \n",
       "175           NaN   8857106890026  1000483764   \n",
       "177           NaN   PSEUDOBARCODE  1109100001   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0              НАША МАМА Пена д/ванны детская 400мл №1          NaN   \n",
       "1    KLORANE Шампунь с Органич Экстрактом Льняного ...          NaN   \n",
       "2    KLORANE Шампунь Восстанав с Органич Маслом Куп...          NaN   \n",
       "3    KLORANE Детокс-Шампунь с Органич Экстракт Водн...          NaN   \n",
       "4    DUCRAY KELUAL DS Гель смягч пенящийся от раздр...          NaN   \n",
       "..                                                 ...          ...   \n",
       "172  DOVE Антиперспирант аэрозольМягкостьХлопка150м...          NaN   \n",
       "173  REXONA Антиперспирант спрей жен Красота 150мл: 12          NaN   \n",
       "174                       JINDA Шампунь Травяной 250мл          NaN   \n",
       "175         JINDA Кондиционер Для Волос Травяной 250мл          NaN   \n",
       "177  МОЕ СОЛНЫШКО (м) шампунь леденец/мандарин (Ава...          NaN   \n",
       "\n",
       "    4KAM Product Subcategory Usage Price Segment         Brand  ...  \\\n",
       "0            NaN         NaN   NaN           NaN         Шаума  ...   \n",
       "1            NaN         NaN   NaN           NaN       KLORANE  ...   \n",
       "2            NaN         NaN   NaN           NaN       KLORANE  ...   \n",
       "3            NaN         NaN   NaN           NaN       KLORANE  ...   \n",
       "4            NaN         NaN   NaN           NaN        DUCRAY  ...   \n",
       "..           ...         ...   ...           ...           ...  ...   \n",
       "172          NaN         NaN   NaN           NaN          Dove  ...   \n",
       "173          NaN         NaN   NaN           NaN        Rexona  ...   \n",
       "174          NaN         NaN   NaN           NaN         JINDA  ...   \n",
       "175          NaN         NaN   NaN           NaN         JINDA  ...   \n",
       "177          NaN         NaN   NaN           NaN  Мое солнышко  ...   \n",
       "\n",
       "    Size Cluster Qty Washloads Size Concatenate Product line Price SC  \\\n",
       "0            NaN           NaN              NaN          NaN      NaN   \n",
       "1            NaN           NaN              NaN          NaN      NaN   \n",
       "2            NaN           NaN              NaN          NaN      NaN   \n",
       "3            NaN           NaN              NaN          NaN      NaN   \n",
       "4            NaN           NaN              NaN          NaN      NaN   \n",
       "..           ...           ...              ...          ...      ...   \n",
       "172          NaN           NaN              NaN          NaN      NaN   \n",
       "173          NaN           NaN              NaN          NaN      NaN   \n",
       "174          NaN           NaN              NaN          NaN      NaN   \n",
       "175          NaN           NaN              NaN          NaN      NaN   \n",
       "177          NaN           NaN              NaN          NaN      NaN   \n",
       "\n",
       "    Promo Type Promo Details Ignore SKU  isNielsen  New Product  \n",
       "0          NaN           NaN        NaN        NaN            1  \n",
       "1          NaN           NaN        NaN        NaN            1  \n",
       "2          NaN           NaN        NaN        NaN            1  \n",
       "3          NaN           NaN        NaN        NaN            1  \n",
       "4          NaN           NaN        NaN        NaN            1  \n",
       "..         ...           ...        ...        ...          ...  \n",
       "172        NaN           NaN        NaN        NaN            1  \n",
       "173        NaN           NaN        NaN        NaN            1  \n",
       "174        NaN           NaN        NaN        NaN            1  \n",
       "175        NaN           NaN        NaN        NaN            1  \n",
       "177        NaN           NaN        NaN        NaN            1  \n",
       "\n",
       "[152 rows x 30 columns]"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def find_best_brand(product_name, brands, threshold=80):\n",
    "    temp = product_name.split()\n",
    "    product_name = \" \".join(temp[0:2])\n",
    "    best_match = process.extractOne(product_name, brands)\n",
    "    \n",
    "    if best_match and best_match[1] >= threshold:  # Проверяем, что сходство выше порога\n",
    "        return best_match[0]  # Возвращаем только название бренда\n",
    "    return None  # Возвращаем None, если сходство ниже порога\n",
    "\n",
    "# Применяем функцию только к пустым значениям в столбце Brand\n",
    "df['Brand'] = df.apply(lambda row: find_best_brand(row['Product Name'], brand['Бренд'].tolist()) if pd.isna(row['Brand']) else row['Brand'], axis=1)\n",
    "df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "0469af18-a636-4812-a32d-5e594903b994",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "ename": "KeyboardInterrupt",
     "evalue": "",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[8], line 19\u001b[0m\n\u001b[0;32m     16\u001b[0m         \u001b[38;5;28;01mreturn\u001b[39;00m predicted_class\n\u001b[0;32m     18\u001b[0m \u001b[38;5;66;03m# Заполнение пустых значений в столбце Subcategory\u001b[39;00m\n\u001b[1;32m---> 19\u001b[0m df[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mBrand\u001b[39m\u001b[38;5;124m\"\u001b[39m] \u001b[38;5;241m=\u001b[39m df\u001b[38;5;241m.\u001b[39mapply(\n\u001b[0;32m     20\u001b[0m     \u001b[38;5;28;01mlambda\u001b[39;00m row: predict_brand(row[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mProduct Name\u001b[39m\u001b[38;5;124m\"\u001b[39m]) \u001b[38;5;28;01mif\u001b[39;00m pd\u001b[38;5;241m.\u001b[39misna(row[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mBrand\u001b[39m\u001b[38;5;124m\"\u001b[39m]) \u001b[38;5;28;01melse\u001b[39;00m row[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mBrand\u001b[39m\u001b[38;5;124m\"\u001b[39m],\n\u001b[0;32m     21\u001b[0m     axis\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1\u001b[39m)\n\u001b[0;32m     22\u001b[0m df\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\pandas\\core\\frame.py:10374\u001b[0m, in \u001b[0;36mDataFrame.apply\u001b[1;34m(self, func, axis, raw, result_type, args, by_row, engine, engine_kwargs, **kwargs)\u001b[0m\n\u001b[0;32m  10360\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m \u001b[38;5;21;01mpandas\u001b[39;00m\u001b[38;5;21;01m.\u001b[39;00m\u001b[38;5;21;01mcore\u001b[39;00m\u001b[38;5;21;01m.\u001b[39;00m\u001b[38;5;21;01mapply\u001b[39;00m \u001b[38;5;28;01mimport\u001b[39;00m frame_apply\n\u001b[0;32m  10362\u001b[0m op \u001b[38;5;241m=\u001b[39m frame_apply(\n\u001b[0;32m  10363\u001b[0m     \u001b[38;5;28mself\u001b[39m,\n\u001b[0;32m  10364\u001b[0m     func\u001b[38;5;241m=\u001b[39mfunc,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m  10372\u001b[0m     kwargs\u001b[38;5;241m=\u001b[39mkwargs,\n\u001b[0;32m  10373\u001b[0m )\n\u001b[1;32m> 10374\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m op\u001b[38;5;241m.\u001b[39mapply()\u001b[38;5;241m.\u001b[39m__finalize__(\u001b[38;5;28mself\u001b[39m, method\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mapply\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\pandas\\core\\apply.py:916\u001b[0m, in \u001b[0;36mFrameApply.apply\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m    913\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mraw:\n\u001b[0;32m    914\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mapply_raw(engine\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mengine, engine_kwargs\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mengine_kwargs)\n\u001b[1;32m--> 916\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mapply_standard()\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\pandas\\core\\apply.py:1063\u001b[0m, in \u001b[0;36mFrameApply.apply_standard\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m   1061\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mapply_standard\u001b[39m(\u001b[38;5;28mself\u001b[39m):\n\u001b[0;32m   1062\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mengine \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mpython\u001b[39m\u001b[38;5;124m\"\u001b[39m:\n\u001b[1;32m-> 1063\u001b[0m         results, res_index \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mapply_series_generator()\n\u001b[0;32m   1064\u001b[0m     \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[0;32m   1065\u001b[0m         results, res_index \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mapply_series_numba()\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\pandas\\core\\apply.py:1081\u001b[0m, in \u001b[0;36mFrameApply.apply_series_generator\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m   1078\u001b[0m \u001b[38;5;28;01mwith\u001b[39;00m option_context(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mmode.chained_assignment\u001b[39m\u001b[38;5;124m\"\u001b[39m, \u001b[38;5;28;01mNone\u001b[39;00m):\n\u001b[0;32m   1079\u001b[0m     \u001b[38;5;28;01mfor\u001b[39;00m i, v \u001b[38;5;129;01min\u001b[39;00m \u001b[38;5;28menumerate\u001b[39m(series_gen):\n\u001b[0;32m   1080\u001b[0m         \u001b[38;5;66;03m# ignore SettingWithCopy here in case the user mutates\u001b[39;00m\n\u001b[1;32m-> 1081\u001b[0m         results[i] \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mfunc(v, \u001b[38;5;241m*\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mkwargs)\n\u001b[0;32m   1082\u001b[0m         \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(results[i], ABCSeries):\n\u001b[0;32m   1083\u001b[0m             \u001b[38;5;66;03m# If we have a view on v, we need to make a copy because\u001b[39;00m\n\u001b[0;32m   1084\u001b[0m             \u001b[38;5;66;03m#  series_generator will swap out the underlying data\u001b[39;00m\n\u001b[0;32m   1085\u001b[0m             results[i] \u001b[38;5;241m=\u001b[39m results[i]\u001b[38;5;241m.\u001b[39mcopy(deep\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mFalse\u001b[39;00m)\n",
      "Cell \u001b[1;32mIn[8], line 20\u001b[0m, in \u001b[0;36m<lambda>\u001b[1;34m(row)\u001b[0m\n\u001b[0;32m     16\u001b[0m         \u001b[38;5;28;01mreturn\u001b[39;00m predicted_class\n\u001b[0;32m     18\u001b[0m \u001b[38;5;66;03m# Заполнение пустых значений в столбце Subcategory\u001b[39;00m\n\u001b[0;32m     19\u001b[0m df[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mBrand\u001b[39m\u001b[38;5;124m\"\u001b[39m] \u001b[38;5;241m=\u001b[39m df\u001b[38;5;241m.\u001b[39mapply(\n\u001b[1;32m---> 20\u001b[0m     \u001b[38;5;28;01mlambda\u001b[39;00m row: predict_brand(row[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mProduct Name\u001b[39m\u001b[38;5;124m\"\u001b[39m]) \u001b[38;5;28;01mif\u001b[39;00m pd\u001b[38;5;241m.\u001b[39misna(row[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mBrand\u001b[39m\u001b[38;5;124m\"\u001b[39m]) \u001b[38;5;28;01melse\u001b[39;00m row[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mBrand\u001b[39m\u001b[38;5;124m\"\u001b[39m],\n\u001b[0;32m     21\u001b[0m     axis\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1\u001b[39m)\n\u001b[0;32m     22\u001b[0m df\n",
      "Cell \u001b[1;32mIn[8], line 3\u001b[0m, in \u001b[0;36mpredict_brand\u001b[1;34m(brand, threshold)\u001b[0m\n\u001b[0;32m      2\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mpredict_brand\u001b[39m(brand, threshold\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m0.9\u001b[39m):\n\u001b[1;32m----> 3\u001b[0m     loaded_model \u001b[38;5;241m=\u001b[39m joblib\u001b[38;5;241m.\u001b[39mload(\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mproduct_classifier_brand.pkl\u001b[39m\u001b[38;5;124m'\u001b[39m)\n\u001b[0;32m      5\u001b[0m     \u001b[38;5;66;03m# Получаем вероятности для каждого класса\u001b[39;00m\n\u001b[0;32m      6\u001b[0m     probabilities \u001b[38;5;241m=\u001b[39m loaded_model\u001b[38;5;241m.\u001b[39mpredict_proba([brand])\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\joblib\\numpy_pickle.py:658\u001b[0m, in \u001b[0;36mload\u001b[1;34m(filename, mmap_mode)\u001b[0m\n\u001b[0;32m    652\u001b[0m             \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(fobj, \u001b[38;5;28mstr\u001b[39m):\n\u001b[0;32m    653\u001b[0m                 \u001b[38;5;66;03m# if the returned file object is a string, this means we\u001b[39;00m\n\u001b[0;32m    654\u001b[0m                 \u001b[38;5;66;03m# try to load a pickle file generated with an version of\u001b[39;00m\n\u001b[0;32m    655\u001b[0m                 \u001b[38;5;66;03m# Joblib so we load it with joblib compatibility function.\u001b[39;00m\n\u001b[0;32m    656\u001b[0m                 \u001b[38;5;28;01mreturn\u001b[39;00m load_compatibility(fobj)\n\u001b[1;32m--> 658\u001b[0m             obj \u001b[38;5;241m=\u001b[39m _unpickle(fobj, filename, mmap_mode)\n\u001b[0;32m    659\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m obj\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3_new\\Lib\\site-packages\\joblib\\numpy_pickle.py:577\u001b[0m, in \u001b[0;36m_unpickle\u001b[1;34m(fobj, filename, mmap_mode)\u001b[0m\n\u001b[0;32m    575\u001b[0m obj \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;01mNone\u001b[39;00m\n\u001b[0;32m    576\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m--> 577\u001b[0m     obj \u001b[38;5;241m=\u001b[39m unpickler\u001b[38;5;241m.\u001b[39mload()\n\u001b[0;32m    578\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m unpickler\u001b[38;5;241m.\u001b[39mcompat_mode:\n\u001b[0;32m    579\u001b[0m         warnings\u001b[38;5;241m.\u001b[39mwarn(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mThe file \u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124m has been generated with a \u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    580\u001b[0m                       \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mjoblib version less than 0.10. \u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    581\u001b[0m                       \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mPlease regenerate this pickle file.\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    582\u001b[0m                       \u001b[38;5;241m%\u001b[39m filename,\n\u001b[0;32m    583\u001b[0m                       \u001b[38;5;167;01mDeprecationWarning\u001b[39;00m, stacklevel\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m3\u001b[39m)\n",
      "File \u001b[1;32m~\\AppData\\Local\\anaconda3_new\\Lib\\pickle.py:1250\u001b[0m, in \u001b[0;36m_Unpickler.load\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m   1248\u001b[0m dispatch \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mdispatch\n\u001b[0;32m   1249\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m-> 1250\u001b[0m     \u001b[38;5;28;01mwhile\u001b[39;00m \u001b[38;5;28;01mTrue\u001b[39;00m:\n\u001b[0;32m   1251\u001b[0m         key \u001b[38;5;241m=\u001b[39m read(\u001b[38;5;241m1\u001b[39m)\n\u001b[0;32m   1252\u001b[0m         \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m key:\n",
      "\u001b[1;31mKeyboardInterrupt\u001b[0m: "
     ]
    }
   ],
   "source": [
    "# Функция предсказания с учетом неопределенности\n",
    "def predict_brand(brand, threshold=0.9):\n",
    "    loaded_model = joblib.load('product_classifier_brand.pkl')\n",
    "    \n",
    "    # Получаем вероятности для каждого класса\n",
    "    probabilities = loaded_model.predict_proba([brand])\n",
    "    max_probability = np.max(probabilities)\n",
    "\n",
    "    # Получаем предсказанную подкатегорию\n",
    "    predicted_class = loaded_model.predict([brand])[0]\n",
    "\n",
    "    # Проверяем вероятность\n",
    "    if max_probability < threshold:\n",
    "        return \"хз\"\n",
    "    else:\n",
    "        return predicted_class\n",
    "\n",
    "# Заполнение пустых значений в столбце Subcategory\n",
    "df[\"Brand\"] = df.apply(\n",
    "    lambda row: predict_brand(row[\"Product Name\"]) if pd.isna(row[\"Brand\"]) else row[\"Brand\"],\n",
    "    axis=1)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "2268840f-487b-46da-aa4c-9ee5768d4d3c",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Size Cluster</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 30 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "2             NaN  2000023590470  1000499201   \n",
       "3             NaN  3282770074062  1000354605   \n",
       "4             NaN  3282770144659  1000490216   \n",
       "5             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "165           NaN  8700216171748  1000500913   \n",
       "173           NaN  8801046288962  1000543918   \n",
       "174           NaN  8801046866221  1000542602   \n",
       "175           NaN  8801046902233  1000507964   \n",
       "176           NaN  8995151130046  8000038246   \n",
       "\n",
       "                                          Product Name Product Type  \\\n",
       "0    VITATEKA Облепиховое масло 180 Алтай Элитное 1...          NaN   \n",
       "2    SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...          NaN   \n",
       "3       KLORANE Кондиционер с экстрактом ромашки 200мл          NaN   \n",
       "4    KLORANE Бальзам Д/Волос Восст с Органич Маслом...          NaN   \n",
       "5    KLORANE Шампунь восст с органич маслом купуасу...          NaN   \n",
       "..                                                 ...          ...   \n",
       "165  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...          NaN   \n",
       "173         KERASYS Шампунь для волос лечение 180мл №1          NaN   \n",
       "174  KERASYS Кондиционер для лечения волос освежающ...          NaN   \n",
       "175   KERASYS Кондиционер для волос Balancing 500мл УЗ          NaN   \n",
       "176  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...          NaN   \n",
       "\n",
       "    4KAM Product Subcategory Usage Price Segment Brand  ... Size Cluster  \\\n",
       "0            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "2            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "3            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "4            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "5            NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "..           ...         ...   ...           ...   ...  ...          ...   \n",
       "165          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "173          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "174          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "175          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "176          NaN         NaN   NaN           NaN   NaN  ...          NaN   \n",
       "\n",
       "    Qty Washloads Size Concatenate Product line Price SC Promo Type  \\\n",
       "0             NaN              NaN          NaN      NaN        NaN   \n",
       "2             NaN              NaN          NaN      NaN        NaN   \n",
       "3             NaN              NaN          NaN      NaN        NaN   \n",
       "4             NaN              NaN          NaN      NaN        NaN   \n",
       "5             NaN              NaN          NaN      NaN        NaN   \n",
       "..            ...              ...          ...      ...        ...   \n",
       "165           NaN              NaN          NaN      NaN        NaN   \n",
       "173           NaN              NaN          NaN      NaN        NaN   \n",
       "174           NaN              NaN          NaN      NaN        NaN   \n",
       "175           NaN              NaN          NaN      NaN        NaN   \n",
       "176           NaN              NaN          NaN      NaN        NaN   \n",
       "\n",
       "    Promo Details Ignore SKU  isNielsen  New Product  \n",
       "0             NaN        NaN        NaN            1  \n",
       "2             NaN        NaN        NaN            1  \n",
       "3             NaN        NaN        NaN            1  \n",
       "4             NaN        NaN        NaN            1  \n",
       "5             NaN        NaN        NaN            1  \n",
       "..            ...        ...        ...          ...  \n",
       "165           NaN        NaN        NaN            1  \n",
       "173           NaN        NaN        NaN            1  \n",
       "174           NaN        NaN        NaN            1  \n",
       "175           NaN        NaN        NaN            1  \n",
       "176           NaN        NaN        NaN            1  \n",
       "\n",
       "[98 rows x 30 columns]"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "e751233a-1eed-4651-be12-f69a7c226da1",
   "metadata": {},
   "outputs": [],
   "source": [
    "df.to_excel(\"магнит фикс.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "f2b0e189-e68c-4c0d-8097-b1659dd74ed1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>Product Type</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Usage</th>\n",
       "      <th>Price Segment</th>\n",
       "      <th>Brand</th>\n",
       "      <th>...</th>\n",
       "      <th>Qty Washloads</th>\n",
       "      <th>Size Concatenate</th>\n",
       "      <th>Product line</th>\n",
       "      <th>Price SC</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Ignore SKU</th>\n",
       "      <th>isNielsen</th>\n",
       "      <th>New Product</th>\n",
       "      <th>Category</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>NaN</td>\n",
       "      <td>4660041994155</td>\n",
       "      <td>1000534269</td>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Treatments</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>VITATEKA</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>NaN</td>\n",
       "      <td>2000023590470</td>\n",
       "      <td>1000499201</td>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>SYSTEM 4</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770074062</td>\n",
       "      <td>1000354605</td>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144659</td>\n",
       "      <td>1000490216</td>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>NaN</td>\n",
       "      <td>3282770144727</td>\n",
       "      <td>1000560270</td>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>KLORANE</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>93</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8700216171748</td>\n",
       "      <td>1000500913</td>\n",
       "      <td>ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BOM</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Pantene</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>94</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046288962</td>\n",
       "      <td>1000543918</td>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>95</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046866221</td>\n",
       "      <td>1000542602</td>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>96</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8801046902233</td>\n",
       "      <td>1000507964</td>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Conditioners</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Kerasys</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>97</th>\n",
       "      <td>NaN</td>\n",
       "      <td>8995151130046</td>\n",
       "      <td>8000038246</td>\n",
       "      <td>MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>Hair care</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 31 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Import status            EAN         PLU  \\\n",
       "0             NaN  4660041994155  1000534269   \n",
       "1             NaN  2000023590470  1000499201   \n",
       "2             NaN  3282770074062  1000354605   \n",
       "3             NaN  3282770144659  1000490216   \n",
       "4             NaN  3282770144727  1000560270   \n",
       "..            ...            ...         ...   \n",
       "93            NaN  8700216171748  1000500913   \n",
       "94            NaN  8801046288962  1000543918   \n",
       "95            NaN  8801046866221  1000542602   \n",
       "96            NaN  8801046902233  1000507964   \n",
       "97            NaN  8995151130046  8000038246   \n",
       "\n",
       "                                         Product Name  Product Type  \\\n",
       "0   VITATEKA Облепиховое масло 180 Алтай Элитное 1...           NaN   \n",
       "1   SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...           NaN   \n",
       "2      KLORANE Кондиционер с экстрактом ромашки 200мл           NaN   \n",
       "3   KLORANE Бальзам Д/Волос Восст с Органич Маслом...           NaN   \n",
       "4   KLORANE Шампунь восст с органич маслом купуасу...           NaN   \n",
       "..                                                ...           ...   \n",
       "93  ПН VENUS SMOOTH Станок с 1 кассетой +Шампунь P...           NaN   \n",
       "94         KERASYS Шампунь для волос лечение 180мл №1           NaN   \n",
       "95  KERASYS Кондиционер для лечения волос освежающ...           NaN   \n",
       "96   KERASYS Кондиционер для волос Balancing 500мл УЗ           NaN   \n",
       "97  MUSTIKA RATU ШАМПУНЬ ДЛЯ ВОЛОС RICE STRAW /MER...           NaN   \n",
       "\n",
       "    4KAM Product   Subcategory  Usage  Price Segment     Brand  ...  \\\n",
       "0            NaN    Treatments    NaN            NaN  VITATEKA  ...   \n",
       "1            NaN  Conditioners    NaN            NaN  SYSTEM 4  ...   \n",
       "2            NaN  Conditioners    NaN            NaN   KLORANE  ...   \n",
       "3            NaN  Conditioners    NaN            NaN   KLORANE  ...   \n",
       "4            NaN       Shampoo    NaN            NaN   KLORANE  ...   \n",
       "..           ...           ...    ...            ...       ...  ...   \n",
       "93           NaN           BOM    NaN            NaN   Pantene  ...   \n",
       "94           NaN       Shampoo    NaN            NaN   Kerasys  ...   \n",
       "95           NaN  Conditioners    NaN            NaN   Kerasys  ...   \n",
       "96           NaN  Conditioners    NaN            NaN   Kerasys  ...   \n",
       "97           NaN       Shampoo    NaN            NaN       NaN  ...   \n",
       "\n",
       "    Qty Washloads  Size Concatenate  Product line  Price SC  Promo Type  \\\n",
       "0             NaN               NaN           NaN       NaN         NaN   \n",
       "1             NaN               NaN           NaN       NaN         NaN   \n",
       "2             NaN               NaN           NaN       NaN         NaN   \n",
       "3             NaN               NaN           NaN       NaN         NaN   \n",
       "4             NaN               NaN           NaN       NaN         NaN   \n",
       "..            ...               ...           ...       ...         ...   \n",
       "93            NaN               NaN           NaN       NaN         NaN   \n",
       "94            NaN               NaN           NaN       NaN         NaN   \n",
       "95            NaN               NaN           NaN       NaN         NaN   \n",
       "96            NaN               NaN           NaN       NaN         NaN   \n",
       "97            NaN               NaN           NaN       NaN         NaN   \n",
       "\n",
       "    Promo Details  Ignore SKU  isNielsen  New Product   Category  \n",
       "0             NaN         NaN        NaN            1  Hair care  \n",
       "1             NaN         NaN        NaN            1  Hair care  \n",
       "2             NaN         NaN        NaN            1  Hair care  \n",
       "3             NaN         NaN        NaN            1  Hair care  \n",
       "4             NaN         NaN        NaN            1  Hair care  \n",
       "..            ...         ...        ...          ...        ...  \n",
       "93            NaN         NaN        NaN            1        NaN  \n",
       "94            NaN         NaN        NaN            1  Hair care  \n",
       "95            NaN         NaN        NaN            1  Hair care  \n",
       "96            NaN         NaN        NaN            1  Hair care  \n",
       "97            NaN         NaN        NaN            1  Hair care  \n",
       "\n",
       "[98 rows x 31 columns]"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_excel(\"магнит фикс.xlsx\")\n",
    "df = df[df[\"4KAM Product\"].isna()]\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "2c316958-38ef-4c6d-a0ab-9c77e84f54b4",
   "metadata": {},
   "outputs": [],
   "source": [
    "base = pd.read_excel(\"база май.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "8cad4a38-ad6a-4a4c-be3b-5d524dc4bcde",
   "metadata": {},
   "outputs": [],
   "source": [
    "base = pd.read_excel(\"база скю лаб (1).xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "e510bfeb-326d-4937-a178-84425d6b13e1",
   "metadata": {},
   "outputs": [],
   "source": [
    "base['Размер для названия'] = pd.to_numeric(base['Размер для названия'], errors='coerce')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "9a3feb18-3e05-40e6-900c-a31866903aa4",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\geyntd\\AppData\\Local\\Temp\\ipykernel_11812\\1249140017.py:38: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  base_col['size_col'] = base_col[\"Мультифункционал/Оттенок\"].astype(\"str\").apply(cut_num)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Brand</th>\n",
       "      <th>Size</th>\n",
       "      <th>Category</th>\n",
       "      <th>Size Cluster</th>\n",
       "      <th>size_col</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20009311</td>\n",
       "      <td>Гель-воск д/волос Тафт Блеск 75мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Modelling</td>\n",
       "      <td>Тафт</td>\n",
       "      <td>75.0</td>\n",
       "      <td>Styling</td>\n",
       "      <td>0-149</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20014681</td>\n",
       "      <td>Краска д/волос Палетт1-0 (N1) Чёрный</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Permanent</td>\n",
       "      <td>Палетт</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Coloration</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1-0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20014698</td>\n",
       "      <td>Краска д/волос Палетт 3-0 (N2) Тёмно-каштановый</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Permanent</td>\n",
       "      <td>Палетт</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Coloration</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3-0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20014704</td>\n",
       "      <td>Краска д/волос Палетт 4-0 (N3) Каштановый</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Permanent</td>\n",
       "      <td>Палетт</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Coloration</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4-0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20014711</td>\n",
       "      <td>Краска д/волос Палетт 6-0 (N5) Тёмно-русый</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Permanent</td>\n",
       "      <td>Палетт</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Coloration</td>\n",
       "      <td>NaN</td>\n",
       "      <td>6-0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>300</th>\n",
       "      <td>300</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23233188</td>\n",
       "      <td>Спрей Тафт Термозащита 180мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Liquids</td>\n",
       "      <td>Тафт</td>\n",
       "      <td>180.0</td>\n",
       "      <td>Styling</td>\n",
       "      <td>150-200</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>301</th>\n",
       "      <td>301</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23232440</td>\n",
       "      <td>Шампунь Shamtu Питание и сила с экстрактами фр...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>Shamtu</td>\n",
       "      <td>300.0</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>251-400</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>302</th>\n",
       "      <td>302</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23232358</td>\n",
       "      <td>Шампунь мужской Шаума Против Перхоти Интенсивн...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>Шаума</td>\n",
       "      <td>650.0</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>501-999</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>303</th>\n",
       "      <td>303</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23233072</td>\n",
       "      <td>Шампунь Шаума Мицеллярный Уход 370мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>Шаума</td>\n",
       "      <td>370.0</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>251-400</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>304</th>\n",
       "      <td>304</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23233096</td>\n",
       "      <td>Экспресс-кондиционер Глисс Кур Драгоценное пит...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Treatments</td>\n",
       "      <td>Глисс Кур</td>\n",
       "      <td>200.0</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>200-250</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>305 rows × 14 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     Unnamed: 0  Import status  EAN       PLU  \\\n",
       "0             0            NaN  NaN  20009311   \n",
       "1             1            NaN  NaN  20014681   \n",
       "2             2            NaN  NaN  20014698   \n",
       "3             3            NaN  NaN  20014704   \n",
       "4             4            NaN  NaN  20014711   \n",
       "..          ...            ...  ...       ...   \n",
       "300         300            NaN  NaN  23233188   \n",
       "301         301            NaN  NaN  23232440   \n",
       "302         302            NaN  NaN  23232358   \n",
       "303         303            NaN  NaN  23233072   \n",
       "304         304            NaN  NaN  23233096   \n",
       "\n",
       "                                          Product Name  4KAM Product  \\\n",
       "0                    Гель-воск д/волос Тафт Блеск 75мл           NaN   \n",
       "1                 Краска д/волос Палетт1-0 (N1) Чёрный           NaN   \n",
       "2      Краска д/волос Палетт 3-0 (N2) Тёмно-каштановый           NaN   \n",
       "3            Краска д/волос Палетт 4-0 (N3) Каштановый           NaN   \n",
       "4           Краска д/волос Палетт 6-0 (N5) Тёмно-русый           NaN   \n",
       "..                                                 ...           ...   \n",
       "300                       Спрей Тафт Термозащита 180мл           NaN   \n",
       "301  Шампунь Shamtu Питание и сила с экстрактами фр...           NaN   \n",
       "302  Шампунь мужской Шаума Против Перхоти Интенсивн...           NaN   \n",
       "303               Шампунь Шаума Мицеллярный Уход 370мл           NaN   \n",
       "304  Экспресс-кондиционер Глисс Кур Драгоценное пит...           NaN   \n",
       "\n",
       "     Promo Details  Promo Type Subcategory      Brand   Size    Category  \\\n",
       "0              NaN         NaN   Modelling       Тафт   75.0     Styling   \n",
       "1              NaN         NaN   Permanent     Палетт    NaN  Coloration   \n",
       "2              NaN         NaN   Permanent     Палетт    NaN  Coloration   \n",
       "3              NaN         NaN   Permanent     Палетт    NaN  Coloration   \n",
       "4              NaN         NaN   Permanent     Палетт    NaN  Coloration   \n",
       "..             ...         ...         ...        ...    ...         ...   \n",
       "300            NaN         NaN     Liquids       Тафт  180.0     Styling   \n",
       "301            NaN         NaN     Shampoo     Shamtu  300.0   Hair care   \n",
       "302            NaN         NaN     Shampoo      Шаума  650.0   Hair care   \n",
       "303            NaN         NaN     Shampoo      Шаума  370.0   Hair care   \n",
       "304            NaN         NaN  Treatments  Глисс Кур  200.0   Hair care   \n",
       "\n",
       "    Size Cluster size_col  \n",
       "0          0-149      NaN  \n",
       "1            NaN      1-0  \n",
       "2            NaN      3-0  \n",
       "3            NaN      4-0  \n",
       "4            NaN      6-0  \n",
       "..           ...      ...  \n",
       "300      150-200      NaN  \n",
       "301      251-400      NaN  \n",
       "302      501-999      NaN  \n",
       "303      251-400      NaN  \n",
       "304      200-250      NaN  \n",
       "\n",
       "[305 rows x 14 columns]"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import re\n",
    "\n",
    "base_col = base[base[\"Категория\"] == \"Coloration\"]\n",
    "\n",
    "def sub(product_name):\n",
    "    filtered = df[df[\"Product Name\"] == product_name][\"Subcategory\"]\n",
    "    if not filtered.empty:\n",
    "        return filtered.values[0] == \"Permanent\"\n",
    "    return False\n",
    "\n",
    "def sub_base(product_name):\n",
    "    filtered = base_col[base_col[\"Наименование\"] == product_name][\"Категория\"]\n",
    "    if not filtered.empty:\n",
    "        return filtered.values[0] == \"Coloration\"\n",
    "    return False\n",
    "    \n",
    "def cut_num_df(product_name):\n",
    "    if sub(product_name):\n",
    "        #p_l = r\"#[0-9]+[^мл|^2B|^л|^г][.-,/Ud,]*[0-9]*\"\n",
    "        p = r\"[0-9]+[^мл|^2B|^л|^г][.\\-,/Ud,]*[0-9]*\"\n",
    "        if re.findall(p, product_name, re.I):\n",
    "            return re.findall(p, product_name)[0]\n",
    "        else:\n",
    "            return np.nan\n",
    "    else:\n",
    "        return np.nan\n",
    "\n",
    "def cut_num(product_name):\n",
    "    p = r\"[0-9]+[^мл|^2B|^л|^г][.\\-,/Ud,]*[0-9]*\"\n",
    "    if re.findall(p, product_name, re.I):\n",
    "        return re.findall(p, product_name)[0]\n",
    "    else:\n",
    "        return np.nan\n",
    "        \n",
    "df['size_col'] = df['Product Name'].apply(cut_num_df)\n",
    "base_col['size_col'] = base_col[\"Мультифункционал/Оттенок\"].astype(\"str\").apply(cut_num)\n",
    "\n",
    "df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "3c295a62-1586-477f-92ee-8aea9e41be69",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Metro</th>\n",
       "      <th>Base</th>\n",
       "      <th>Cosine Similarity</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>VITATEKA Облепиховое масло 180 Алтай Элитное 1...</td>\n",
       "      <td>PL ВИТАТЕКА Репейное масло 100мл</td>\n",
       "      <td>0.534522</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...</td>\n",
       "      <td>SYSTEM 4 Бальз-Конд Терапевт Н д/Сух Повр Окра...</td>\n",
       "      <td>0.534522</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>KLORANE Кондиционер с экстрактом ромашки 200мл</td>\n",
       "      <td>KLORANE Конд.гранатом окраш. вол.200мл</td>\n",
       "      <td>0.632456</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>KLORANE Бальзам Д/Волос Восст с Органич Маслом...</td>\n",
       "      <td>KLORANE Бальзам-опол.маслом Манго200мл</td>\n",
       "      <td>0.612372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>KLORANE Шампунь восст с органич маслом купуасу...</td>\n",
       "      <td>KLORANE Детокс-Шампунь с Органич Экстракт Водн...</td>\n",
       "      <td>0.755929</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>KLORANE Детокс-Шампунь с Органич Экстракт Водн...</td>\n",
       "      <td>KLORANE Шампунь Восстанав с Органич Маслом Куп...</td>\n",
       "      <td>0.707107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>VICHY Dercos Интенс Шампунь-Уход п/перх Ds д/с...</td>\n",
       "      <td>VICHY Dercos Technique Инт Шамп-Уход п/п Ds д/...</td>\n",
       "      <td>0.774597</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>PHYTO Color Крем-Краска д/волос Золотистый Бло...</td>\n",
       "      <td>PHYTO Color Крем-Краска д/волос Темный Шатен т...</td>\n",
       "      <td>0.866025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>PHYTO Крем-Краска Для Волос В Наборе Тон 10/Эк...</td>\n",
       "      <td>PHYTO Color Крем-Краска д/волос Темный Шатен т...</td>\n",
       "      <td>0.707107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>MATRIX Total results мега слик шампунь д/лаких...</td>\n",
       "      <td>MATRIX Total Results Хай Амплифай Шамп Д/Объем...</td>\n",
       "      <td>0.745356</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>LOREAL Preference Краска д/в Мулен Руж3.12 174...</td>\n",
       "      <td>LOREAL Preference Краска д/в 5.21 Нотр-Дам 174...</td>\n",
       "      <td>0.790569</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>URIAGE Дезодорант Роликовый 50мл</td>\n",
       "      <td>URIAGE Power 3 Дезодорант тройного действия ро...</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>WELEDA Дезодорант Облепиховый 24 Часа Roll-On ...</td>\n",
       "      <td>WELEDA Дезодорант 24 Ч.ROLL-ON муж.50мл</td>\n",
       "      <td>0.866025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>GREEN MAMA Форм Тайги Бал-Кон д/жир вол календ...</td>\n",
       "      <td>GREEN MAMA Бальзам-конд Фиторегенерация Морск ...</td>\n",
       "      <td>0.522233</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>LEVRANA Шампунь десткий череда 250мл</td>\n",
       "      <td>Levrana Шампунь Череда без слёз, 0,25 л</td>\n",
       "      <td>0.774597</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>МОЕ СОЛНЫШКО Гель для купания и душа детский 4...</td>\n",
       "      <td>МОЕ СОЛН.Гель для куп/душа д/дев.3+400мл</td>\n",
       "      <td>0.666667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>АКУЛЬЯ Сила Акулий Жир Маска д/Волос Активатор...</td>\n",
       "      <td>АКУЛЬЯ Сила Акулий Жир Маска д/Волос Против Вы...</td>\n",
       "      <td>0.816497</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>ОЧИЩЕНИЕ И ЗДОРОВЬЕ Бальзам Для Волос Живая Си...</td>\n",
       "      <td>ОЧИЩЕНИЕ И ЗДОРОВЬЕ Бальзам против перхоти 250...</td>\n",
       "      <td>0.707107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>ЗОЛОТОЙ ШЕЛК Масло репейное д/волос крапива 90мл</td>\n",
       "      <td>ЗОЛОТОЙ ШЕЛК Масло Облеп актив роста вол 90мл(...</td>\n",
       "      <td>0.755929</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>ЗОЛОТОЙ ШЕЛК Filler заполнитель против ломкост...</td>\n",
       "      <td>\"\"ЗШ\"\" Мульт. Масл-элик. Вос. и пит.25мл.</td>\n",
       "      <td>0.353553</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>ОЧИЩЕНИЕ И ЗДОРОВЬЕ Шампунь Дегтярный 250 мл(Э...</td>\n",
       "      <td>ОЧИЩЕНИЕ И ЗДОРОВЬЕ Шампунь Перцовый 250мл</td>\n",
       "      <td>0.577350</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>NATURA SIBERICA men шампунь прот перхоти мощь ...</td>\n",
       "      <td>NS MEN ШАМПУНЬ ПРОТИВ ПЕРХОТИ МОЩЬ МАРАЛА 250 ...</td>\n",
       "      <td>0.836660</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>OLLIN care шампунь увлажняющий 250мл</td>\n",
       "      <td>OLLIN CARE Шампунь увлажняющий 250мл</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>OLLIN Care Маска Против Выпад Волос с Масл Мин...</td>\n",
       "      <td>OLLIN CARE Маска против выпадения 500мл</td>\n",
       "      <td>0.745356</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>OLLIN Basic Line Шампунь Сиян и Блеск с Арган ...</td>\n",
       "      <td>OLLIN Professional BioNika Шампунь Реконстр 75...</td>\n",
       "      <td>0.577350</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>ЗОЛОТОЙ ШЕЛК Концентрат д/Волос 8 Масел Интенс...</td>\n",
       "      <td>ЗОЛОТОЙ Шелк Крем-Спрей с Маслом Усьмы 100мл №1</td>\n",
       "      <td>0.612372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>ЗОЛОТОЙ ШЕЛК Концентрат д/Волос Аминокисл Укре...</td>\n",
       "      <td>ЗОЛОТОЙ Шелк Крем-Спрей с Маслом Усьмы 100мл №1</td>\n",
       "      <td>0.612372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>PLANETA Organica Hair Super Food Шампунь д/вол...</td>\n",
       "      <td>ШАМПУНЬ PLANETA ORGANICA КЕФИРНЫЙ 250МЛ</td>\n",
       "      <td>0.666667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>NATURA SIBERICA Шамп детский 250мл(Перв реш):16</td>\n",
       "      <td>250МЛ ШАМПУНЬ-ГЕЛЬ NATURA SIBERICA ДЕТСК ОТ МА...</td>\n",
       "      <td>0.612372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>NATURA SIBERICA Oblepikha SPG Тоник пепт/укр/р...</td>\n",
       "      <td>NATURA SIBERICA Gzel Спрей д/вол+тел 20в1 Бел ...</td>\n",
       "      <td>0.547723</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>NATURA SIBERICA Oblepikha SPR Шампунь керат/во...</td>\n",
       "      <td>1Л ШАМПУНЬ NATURA SIBERICA ОБЛЕПИХА ГИАЛУРОНОВ...</td>\n",
       "      <td>0.612372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>NATURA SIBERICA Oblepikha SPM Маска гиалурн/ув...</td>\n",
       "      <td>NATURA SIBERICA Gzel Маска д/вол Мороз женьшен...</td>\n",
       "      <td>0.745356</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>FABRIK COSMETOLOGY Шампунь тверд с эф маслом и...</td>\n",
       "      <td>ШАМП ТВЕРД FABRIK COSM ИЛАНГ 55Г</td>\n",
       "      <td>0.753778</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>CONCEPT PROWAY Спрей гиалурон д/сухих и жест в...</td>\n",
       "      <td>198029 - СПРЕЙ ГИАЛУРОН PROWAY 200МЛ</td>\n",
       "      <td>0.612372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>ARAVIA Profes Спрей-Активат д/роста волос Укре...</td>\n",
       "      <td>244729 - СПРЕЙ-АКТИВ Д/РОСТ ВОЛ 150МЛ ARAVIA</td>\n",
       "      <td>0.577350</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>ARAVIA Profes Спрей д/об Тонких Склон К Жирн В...</td>\n",
       "      <td>СПРЕЙ Д/В ARAVIA PROF ALL-IN-ONE 250МЛ</td>\n",
       "      <td>0.577350</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>ARAVIA Professional Шамп c пребиот д/чувст кож...</td>\n",
       "      <td>420МЛ ШАМПУНЬ ARAVIA PROFESSIONAL ESSENTIAL БЕ...</td>\n",
       "      <td>0.612372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>ARAVIA Professional Сыворотка Амп Против Выпад...</td>\n",
       "      <td>ARAVIA Professional Сыворотка с Терм Д/Стим Ро...</td>\n",
       "      <td>0.790569</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>EXCELLENCE DRY Ultra Clinical Спрей Антиперспи...</td>\n",
       "      <td>EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...</td>\n",
       "      <td>0.925820</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>EXCELLENCE DRY Extra Clinical Спрей Антиперспи...</td>\n",
       "      <td>EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...</td>\n",
       "      <td>0.845154</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40</th>\n",
       "      <td>EXCELLENCE DRY Ultra Clinical Dabomatic Антипе...</td>\n",
       "      <td>EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...</td>\n",
       "      <td>0.925820</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41</th>\n",
       "      <td>EXCELLENCE DRY Extra Clinical Dabomatic Антипе...</td>\n",
       "      <td>EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...</td>\n",
       "      <td>0.845154</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>42</th>\n",
       "      <td>DRYCONTROL Drycontrol forte men roll-on дезодо...</td>\n",
       "      <td>DRYCONTROL Forte Men Spray Дезодорант Антиперс...</td>\n",
       "      <td>0.753778</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>43</th>\n",
       "      <td>ONLY BIO Extra virgin бальзам д/волос восстана...</td>\n",
       "      <td>ONLY BIO Extra Virgin Бальзам-уксус д/в виногр...</td>\n",
       "      <td>0.866025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>OLEA Гель Д/Душа Релакс Терапия 300мл</td>\n",
       "      <td>OLEA КР-ГЕЛЬ Д/ДУША РЕЛАКС ТЕРАПИЯ 300МЛ ДИКСИ</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>45</th>\n",
       "      <td>DERMEDIC Шампунь от перхоти capilarte 300мл №1</td>\n",
       "      <td>КАПИЛАРТЕ Шампунь от перхоти 300 мл</td>\n",
       "      <td>0.707107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>46</th>\n",
       "      <td>SYSTEM 4 Шампунь Терапевтическ 3 д/Всех Типов ...</td>\n",
       "      <td>SYSTEM 4 Шампунь Терапевтич 1 д/Норм Жир Кожи ...</td>\n",
       "      <td>0.654654</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47</th>\n",
       "      <td>SYSTEM 4 Шампунь Биоботанический 75мл №1</td>\n",
       "      <td>SYSTEM 4 Шампунь Терапевтич 1 д/Норм Жир Кожи ...</td>\n",
       "      <td>0.866025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>48</th>\n",
       "      <td>KERASYS Шампунь для волос лечение 180мл №1</td>\n",
       "      <td>53450 - ШАМПУНЬ Д/ВОЛ ФЛЕР 180МЛ KERASYS</td>\n",
       "      <td>0.707107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>49</th>\n",
       "      <td>KERASYS Кондиционер для лечения волос освежающ...</td>\n",
       "      <td>KERASYS HAIR CLINIC ADVANCED Кондиционер для в...</td>\n",
       "      <td>0.797724</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50</th>\n",
       "      <td>KERASYS Кондиционер для волос Balancing 500мл УЗ</td>\n",
       "      <td>Kerasys Конд д волос Озд 500мл</td>\n",
       "      <td>0.654654</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Metro  \\\n",
       "0   VITATEKA Облепиховое масло 180 Алтай Элитное 1...   \n",
       "1   SYSTEM 4 Тоник Несмыв T 500мл №2+Кондиц-Спр R ...   \n",
       "2      KLORANE Кондиционер с экстрактом ромашки 200мл   \n",
       "3   KLORANE Бальзам Д/Волос Восст с Органич Маслом...   \n",
       "4   KLORANE Шампунь восст с органич маслом купуасу...   \n",
       "5   KLORANE Детокс-Шампунь с Органич Экстракт Водн...   \n",
       "6   VICHY Dercos Интенс Шампунь-Уход п/перх Ds д/с...   \n",
       "7   PHYTO Color Крем-Краска д/волос Золотистый Бло...   \n",
       "8   PHYTO Крем-Краска Для Волос В Наборе Тон 10/Эк...   \n",
       "9   MATRIX Total results мега слик шампунь д/лаких...   \n",
       "10  LOREAL Preference Краска д/в Мулен Руж3.12 174...   \n",
       "11                   URIAGE Дезодорант Роликовый 50мл   \n",
       "12  WELEDA Дезодорант Облепиховый 24 Часа Roll-On ...   \n",
       "13  GREEN MAMA Форм Тайги Бал-Кон д/жир вол календ...   \n",
       "14               LEVRANA Шампунь десткий череда 250мл   \n",
       "15  МОЕ СОЛНЫШКО Гель для купания и душа детский 4...   \n",
       "16  АКУЛЬЯ Сила Акулий Жир Маска д/Волос Активатор...   \n",
       "17  ОЧИЩЕНИЕ И ЗДОРОВЬЕ Бальзам Для Волос Живая Си...   \n",
       "18   ЗОЛОТОЙ ШЕЛК Масло репейное д/волос крапива 90мл   \n",
       "19  ЗОЛОТОЙ ШЕЛК Filler заполнитель против ломкост...   \n",
       "20  ОЧИЩЕНИЕ И ЗДОРОВЬЕ Шампунь Дегтярный 250 мл(Э...   \n",
       "21  NATURA SIBERICA men шампунь прот перхоти мощь ...   \n",
       "22               OLLIN care шампунь увлажняющий 250мл   \n",
       "23  OLLIN Care Маска Против Выпад Волос с Масл Мин...   \n",
       "24  OLLIN Basic Line Шампунь Сиян и Блеск с Арган ...   \n",
       "25  ЗОЛОТОЙ ШЕЛК Концентрат д/Волос 8 Масел Интенс...   \n",
       "26  ЗОЛОТОЙ ШЕЛК Концентрат д/Волос Аминокисл Укре...   \n",
       "27  PLANETA Organica Hair Super Food Шампунь д/вол...   \n",
       "28    NATURA SIBERICA Шамп детский 250мл(Перв реш):16   \n",
       "29  NATURA SIBERICA Oblepikha SPG Тоник пепт/укр/р...   \n",
       "30  NATURA SIBERICA Oblepikha SPR Шампунь керат/во...   \n",
       "31  NATURA SIBERICA Oblepikha SPM Маска гиалурн/ув...   \n",
       "32  FABRIK COSMETOLOGY Шампунь тверд с эф маслом и...   \n",
       "33  CONCEPT PROWAY Спрей гиалурон д/сухих и жест в...   \n",
       "34  ARAVIA Profes Спрей-Активат д/роста волос Укре...   \n",
       "35  ARAVIA Profes Спрей д/об Тонких Склон К Жирн В...   \n",
       "36  ARAVIA Professional Шамп c пребиот д/чувст кож...   \n",
       "37  ARAVIA Professional Сыворотка Амп Против Выпад...   \n",
       "38  EXCELLENCE DRY Ultra Clinical Спрей Антиперспи...   \n",
       "39  EXCELLENCE DRY Extra Clinical Спрей Антиперспи...   \n",
       "40  EXCELLENCE DRY Ultra Clinical Dabomatic Антипе...   \n",
       "41  EXCELLENCE DRY Extra Clinical Dabomatic Антипе...   \n",
       "42  DRYCONTROL Drycontrol forte men roll-on дезодо...   \n",
       "43  ONLY BIO Extra virgin бальзам д/волос восстана...   \n",
       "44              OLEA Гель Д/Душа Релакс Терапия 300мл   \n",
       "45     DERMEDIC Шампунь от перхоти capilarte 300мл №1   \n",
       "46  SYSTEM 4 Шампунь Терапевтическ 3 д/Всех Типов ...   \n",
       "47           SYSTEM 4 Шампунь Биоботанический 75мл №1   \n",
       "48         KERASYS Шампунь для волос лечение 180мл №1   \n",
       "49  KERASYS Кондиционер для лечения волос освежающ...   \n",
       "50   KERASYS Кондиционер для волос Balancing 500мл УЗ   \n",
       "\n",
       "                                                 Base  Cosine Similarity  \n",
       "0                    PL ВИТАТЕКА Репейное масло 100мл           0.534522  \n",
       "1   SYSTEM 4 Бальз-Конд Терапевт Н д/Сух Повр Окра...           0.534522  \n",
       "2              KLORANE Конд.гранатом окраш. вол.200мл           0.632456  \n",
       "3              KLORANE Бальзам-опол.маслом Манго200мл           0.612372  \n",
       "4   KLORANE Детокс-Шампунь с Органич Экстракт Водн...           0.755929  \n",
       "5   KLORANE Шампунь Восстанав с Органич Маслом Куп...           0.707107  \n",
       "6   VICHY Dercos Technique Инт Шамп-Уход п/п Ds д/...           0.774597  \n",
       "7   PHYTO Color Крем-Краска д/волос Темный Шатен т...           0.866025  \n",
       "8   PHYTO Color Крем-Краска д/волос Темный Шатен т...           0.707107  \n",
       "9   MATRIX Total Results Хай Амплифай Шамп Д/Объем...           0.745356  \n",
       "10  LOREAL Preference Краска д/в 5.21 Нотр-Дам 174...           0.790569  \n",
       "11  URIAGE Power 3 Дезодорант тройного действия ро...           1.000000  \n",
       "12            WELEDA Дезодорант 24 Ч.ROLL-ON муж.50мл           0.866025  \n",
       "13  GREEN MAMA Бальзам-конд Фиторегенерация Морск ...           0.522233  \n",
       "14            Levrana Шампунь Череда без слёз, 0,25 л           0.774597  \n",
       "15           МОЕ СОЛН.Гель для куп/душа д/дев.3+400мл           0.666667  \n",
       "16  АКУЛЬЯ Сила Акулий Жир Маска д/Волос Против Вы...           0.816497  \n",
       "17  ОЧИЩЕНИЕ И ЗДОРОВЬЕ Бальзам против перхоти 250...           0.707107  \n",
       "18  ЗОЛОТОЙ ШЕЛК Масло Облеп актив роста вол 90мл(...           0.755929  \n",
       "19          \"\"ЗШ\"\" Мульт. Масл-элик. Вос. и пит.25мл.           0.353553  \n",
       "20         ОЧИЩЕНИЕ И ЗДОРОВЬЕ Шампунь Перцовый 250мл           0.577350  \n",
       "21  NS MEN ШАМПУНЬ ПРОТИВ ПЕРХОТИ МОЩЬ МАРАЛА 250 ...           0.836660  \n",
       "22               OLLIN CARE Шампунь увлажняющий 250мл           1.000000  \n",
       "23            OLLIN CARE Маска против выпадения 500мл           0.745356  \n",
       "24  OLLIN Professional BioNika Шампунь Реконстр 75...           0.577350  \n",
       "25    ЗОЛОТОЙ Шелк Крем-Спрей с Маслом Усьмы 100мл №1           0.612372  \n",
       "26    ЗОЛОТОЙ Шелк Крем-Спрей с Маслом Усьмы 100мл №1           0.612372  \n",
       "27            ШАМПУНЬ PLANETA ORGANICA КЕФИРНЫЙ 250МЛ           0.666667  \n",
       "28  250МЛ ШАМПУНЬ-ГЕЛЬ NATURA SIBERICA ДЕТСК ОТ МА...           0.612372  \n",
       "29  NATURA SIBERICA Gzel Спрей д/вол+тел 20в1 Бел ...           0.547723  \n",
       "30  1Л ШАМПУНЬ NATURA SIBERICA ОБЛЕПИХА ГИАЛУРОНОВ...           0.612372  \n",
       "31  NATURA SIBERICA Gzel Маска д/вол Мороз женьшен...           0.745356  \n",
       "32                   ШАМП ТВЕРД FABRIK COSM ИЛАНГ 55Г           0.753778  \n",
       "33               198029 - СПРЕЙ ГИАЛУРОН PROWAY 200МЛ           0.612372  \n",
       "34       244729 - СПРЕЙ-АКТИВ Д/РОСТ ВОЛ 150МЛ ARAVIA           0.577350  \n",
       "35             СПРЕЙ Д/В ARAVIA PROF ALL-IN-ONE 250МЛ           0.577350  \n",
       "36  420МЛ ШАМПУНЬ ARAVIA PROFESSIONAL ESSENTIAL БЕ...           0.612372  \n",
       "37  ARAVIA Professional Сыворотка с Терм Д/Стим Ро...           0.790569  \n",
       "38  EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...           0.925820  \n",
       "39  EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...           0.845154  \n",
       "40  EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...           0.925820  \n",
       "41  EXCELLENCE DRY Ultra Clinical Roll-On Антиперс...           0.845154  \n",
       "42  DRYCONTROL Forte Men Spray Дезодорант Антиперс...           0.753778  \n",
       "43  ONLY BIO Extra Virgin Бальзам-уксус д/в виногр...           0.866025  \n",
       "44     OLEA КР-ГЕЛЬ Д/ДУША РЕЛАКС ТЕРАПИЯ 300МЛ ДИКСИ           1.000000  \n",
       "45                КАПИЛАРТЕ Шампунь от перхоти 300 мл           0.707107  \n",
       "46  SYSTEM 4 Шампунь Терапевтич 1 д/Норм Жир Кожи ...           0.654654  \n",
       "47  SYSTEM 4 Шампунь Терапевтич 1 д/Норм Жир Кожи ...           0.866025  \n",
       "48           53450 - ШАМПУНЬ Д/ВОЛ ФЛЕР 180МЛ KERASYS           0.707107  \n",
       "49  KERASYS HAIR CLINIC ADVANCED Кондиционер для в...           0.797724  \n",
       "50                     Kerasys Конд д волос Озд 500мл           0.654654  "
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Создание нового датафрейма для результатов\n",
    "results = []\n",
    "\n",
    "# Итерация по каждой строке первого датафрейма\n",
    "for index, row in df.iterrows():\n",
    "    # Проверка значения в столбце subcategory\n",
    "    # Другие условия фильтрации\n",
    "    if row['Subcategory'] == 'Permanent':\n",
    "        # Условия фильтрации для coloration\n",
    "        filtered_base = base[\n",
    "            (base['Подкатегория'] == row['Subcategory']) &\n",
    "            (base['Бренд'] == row['Brand'])  \n",
    "            #(base_col['size_col'] == row['size_col']) \n",
    "        \n",
    "        ]\n",
    "    elif row['Subcategory'] == 'Semi-permanent':\n",
    "        # Условия фильтрации для coloration\n",
    "        filtered_base = base[\n",
    "            (base['Подкатегория'] == row['Subcategory']) &\n",
    "            (base['Бренд'] == row['Brand'])\n",
    "        ]\n",
    "\n",
    "    elif row['Category'] == 'Deodorants':\n",
    "        # Условия фильтрации для coloration\n",
    "        filtered_base = base[\n",
    "            (base[\"Категория\"] == row[\"Category\"]) &\n",
    "            (base['Бренд'] == row['Brand']) &\n",
    "            (base['Размер для названия'] == row['Size']) \n",
    "        ]\n",
    "    else:\n",
    "        # Другие условия фильтрации\n",
    "        filtered_base = base[\n",
    "            (base['Подкатегория'] == row['Subcategory']) &\n",
    "            (base['Бренд'] == row['Brand']) &\n",
    "            (base['Размер для названия'] == row['Size']) \n",
    "        ]\n",
    "    if not filtered_base.empty:\n",
    "        # Векторизация текстов\n",
    "        series1 = [row['Product Name']]\n",
    "        series2 = filtered_base['Наименование']\n",
    "\n",
    "        vectorizer = TfidfVectorizer()\n",
    "        tfidf_matrix1 = vectorizer.fit_transform(series1)\n",
    "        tfidf_matrix2 = vectorizer.transform(series2)\n",
    "\n",
    "        # Вычисление косинусного сходства\n",
    "        cosine_similarities = cosine_similarity(tfidf_matrix1, tfidf_matrix2)\n",
    "\n",
    "        # Нахождение максимального индекса сходства\n",
    "        max_sim_index = cosine_similarities[0].argmax()\n",
    "        max_similarity = cosine_similarities[0][max_sim_index]\n",
    "\n",
    "        results.append([row['Product Name'], filtered_base['Наименование'].iloc[max_sim_index], max_similarity])\n",
    "\n",
    "# Создание итогового датафрейма\n",
    "result_df_right = pd.DataFrame(results, columns=['Metro', 'Base', 'Cosine Similarity'])\n",
    "result_df_right"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "d9efd779-9f76-431e-ab5e-5ba38162fbab",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Наименование</th>\n",
       "      <th>Имя сцепка</th>\n",
       "      <th>Product format</th>\n",
       "      <th>EAN</th>\n",
       "      <th>Внутренний id SKU</th>\n",
       "      <th>Дата создания</th>\n",
       "      <th>Производитель</th>\n",
       "      <th>Категория</th>\n",
       "      <th>Категория с т.з. Cm panel</th>\n",
       "      <th>Подкатегория</th>\n",
       "      <th>...</th>\n",
       "      <th>Размер для названия</th>\n",
       "      <th>Размер для тонн</th>\n",
       "      <th>Размерный кластер</th>\n",
       "      <th>Qty washload</th>\n",
       "      <th>Size concatenate</th>\n",
       "      <th>Ценовая линейка</th>\n",
       "      <th>Ценовой SC</th>\n",
       "      <th>Промо акция</th>\n",
       "      <th>Промо детали</th>\n",
       "      <th>isNielsen</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>0 rows × 31 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "Empty DataFrame\n",
       "Columns: [Наименование, Имя сцепка, Product format, EAN, Внутренний id SKU, Дата создания, Производитель, Категория, Категория с т.з. Cm panel, Подкатегория, Использование, Ценовой сегмент, Бренд, Концентрированность, Консистенция, Вариант, Отдушка, Запасной блок, Мультифункционал/Оттенок, Тип волос/Гамма, Сегмент, Размер для названия, Размер для тонн, Размерный кластер, Qty washload, Size concatenate, Ценовая линейка, Ценовой SC, Промо акция, Промо детали, isNielsen]\n",
       "Index: []\n",
       "\n",
       "[0 rows x 31 columns]"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "filtered_base"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "266adaf9-09d9-4a64-a381-489060d91f50",
   "metadata": {},
   "outputs": [],
   "source": [
    "result_df_right.to_excel(\"еком чек.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "96be8a56-84fc-4cf4-8105-c810f583fd0f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Import status</th>\n",
       "      <th>EAN</th>\n",
       "      <th>PLU</th>\n",
       "      <th>Product Name</th>\n",
       "      <th>4KAM Product</th>\n",
       "      <th>Promo Details</th>\n",
       "      <th>Promo Type</th>\n",
       "      <th>Subcategory</th>\n",
       "      <th>Brand</th>\n",
       "      <th>Size</th>\n",
       "      <th>Category</th>\n",
       "      <th>Size Cluster</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>7</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20014766</td>\n",
       "      <td>Краска д/волос Палетт  (C10) Серебристый блондин</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Permanent</td>\n",
       "      <td>Палетт</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Coloration</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>11</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20014803</td>\n",
       "      <td>Краска д/волос Палетт E20 (0-00) Осветляющий</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Permanent</td>\n",
       "      <td>Палетт</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Coloration</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>13</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20016708</td>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Liquids</td>\n",
       "      <td>Тафт</td>\n",
       "      <td>150.0</td>\n",
       "      <td>Styling</td>\n",
       "      <td>150-200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>15</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20016722</td>\n",
       "      <td>Пена д/волос Тафт Объем д/тонких сверхсильная ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Foams</td>\n",
       "      <td>Тафт</td>\n",
       "      <td>150.0</td>\n",
       "      <td>Styling</td>\n",
       "      <td>150-200</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>16</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20064815</td>\n",
       "      <td>Лак д/волос Got2b Мегамания 300мл</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Laquer</td>\n",
       "      <td>One4me</td>\n",
       "      <td>300.0</td>\n",
       "      <td>Styling</td>\n",
       "      <td>201-300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>290</th>\n",
       "      <td>290</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4100232835</td>\n",
       "      <td>Schwarzkopf Barnangen Лосьон д/тела Питательны...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>BARNANGEN</td>\n",
       "      <td>400.0</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>251-400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>291</th>\n",
       "      <td>291</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4100232836</td>\n",
       "      <td>Schwarzkopf Barnangen Лосьон д/тела Ухаживающи...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shampoo</td>\n",
       "      <td>BARNANGEN</td>\n",
       "      <td>400.0</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>251-400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>293</th>\n",
       "      <td>293</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4100277540</td>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Shower Gel</td>\n",
       "      <td>Фа</td>\n",
       "      <td>250.0</td>\n",
       "      <td>Душ</td>\n",
       "      <td>101-250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297</th>\n",
       "      <td>297</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23271241</td>\n",
       "      <td>НП Шаума Шампунь мужской Ultra Сила + Фа Гель ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BOM</td>\n",
       "      <td>Шаума</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>298</th>\n",
       "      <td>298</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>23271227</td>\n",
       "      <td>НП Шаума Шампунь Совершенная Длина + Фа Гель д...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BOM</td>\n",
       "      <td>Шаума</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Hair care</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>98 rows × 13 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     Unnamed: 0  Import status  EAN         PLU  \\\n",
       "7             7            NaN  NaN    20014766   \n",
       "11           11            NaN  NaN    20014803   \n",
       "13           13            NaN  NaN    20016708   \n",
       "15           15            NaN  NaN    20016722   \n",
       "16           16            NaN  NaN    20064815   \n",
       "..          ...            ...  ...         ...   \n",
       "290         290            NaN  NaN  4100232835   \n",
       "291         291            NaN  NaN  4100232836   \n",
       "293         293            NaN  NaN  4100277540   \n",
       "297         297            NaN  NaN    23271241   \n",
       "298         298            NaN  NaN    23271227   \n",
       "\n",
       "                                          Product Name 4KAM Product  \\\n",
       "7     Краска д/волос Палетт  (C10) Серебристый блондин          NaN   \n",
       "11        Краска д/волос Палетт E20 (0-00) Осветляющий          NaN   \n",
       "13   Жидкость д/волос Тафт Объем очень сильной фикс...          NaN   \n",
       "15   Пена д/волос Тафт Объем д/тонких сверхсильная ...          NaN   \n",
       "16                   Лак д/волос Got2b Мегамания 300мл          NaN   \n",
       "..                                                 ...          ...   \n",
       "290  Schwarzkopf Barnangen Лосьон д/тела Питательны...          NaN   \n",
       "291  Schwarzkopf Barnangen Лосьон д/тела Ухаживающи...          NaN   \n",
       "293  Гель д/душа Schw Fa муж Pure Revitalize Кактус...          NaN   \n",
       "297  НП Шаума Шампунь мужской Ultra Сила + Фа Гель ...          NaN   \n",
       "298  НП Шаума Шампунь Совершенная Длина + Фа Гель д...          NaN   \n",
       "\n",
       "     Promo Details  Promo Type Subcategory      Brand   Size    Category  \\\n",
       "7              NaN         NaN   Permanent     Палетт    NaN  Coloration   \n",
       "11             NaN         NaN   Permanent     Палетт    NaN  Coloration   \n",
       "13             NaN         NaN     Liquids       Тафт  150.0     Styling   \n",
       "15             NaN         NaN       Foams       Тафт  150.0     Styling   \n",
       "16             NaN         NaN      Laquer     One4me  300.0     Styling   \n",
       "..             ...         ...         ...        ...    ...         ...   \n",
       "290            NaN         NaN     Shampoo  BARNANGEN  400.0   Hair care   \n",
       "291            NaN         NaN     Shampoo  BARNANGEN  400.0   Hair care   \n",
       "293            NaN         NaN  Shower Gel         Фа  250.0         Душ   \n",
       "297            NaN         NaN         BOM      Шаума    NaN   Hair care   \n",
       "298            NaN         NaN         BOM      Шаума    NaN   Hair care   \n",
       "\n",
       "    Size Cluster  \n",
       "7            NaN  \n",
       "11           NaN  \n",
       "13       150-200  \n",
       "15       150-200  \n",
       "16       201-300  \n",
       "..           ...  \n",
       "290      251-400  \n",
       "291      251-400  \n",
       "293      101-250  \n",
       "297          NaN  \n",
       "298          NaN  \n",
       "\n",
       "[98 rows x 13 columns]"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_excel(\"магнит фикс.xlsx\")\n",
    "df = df[df[\"4KAM Product\"].isna()]\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "62233dc3-6ab7-4f43-87bd-10d7a0da187b",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = df.dropna(subset = [\"Product Name\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "481cabbf-2fb3-40be-af1b-3a47a997e67a",
   "metadata": {},
   "outputs": [],
   "source": [
    "def claim(name):\n",
    "    p = r\"[0-9]+\"\n",
    "    p1 = r\"мл\"\n",
    "    if re.findall(p, name):\n",
    "        name = re.sub(p, \"\", name)\n",
    "    if re.findall(p1, name):\n",
    "        name = re.sub(p1, \"\", name)\n",
    "    name = name.split()\n",
    "    if len(name) > 4:\n",
    "        return \" \".join(name[4:])\n",
    "    else:\n",
    "        return \" \".join(name[2:])\n",
    "df[\"claim_len\"] = df[\"Product Name\"].apply(claim)\n",
    "#df.head(50)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "990ff3e4-2679-455d-874c-19362e13784f",
   "metadata": {},
   "outputs": [],
   "source": [
    "base[\"claim_base\"] = base[\"Наименование\"].apply(claim)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "f6c973c7-39d1-43f9-9314-c18333bff48a",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Metro</th>\n",
       "      <th>Base</th>\n",
       "      <th>Cosine Similarity</th>\n",
       "      <th>claim_len</th>\n",
       "      <th>claim_base</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>Тафт 150 Жидкость для укладки Объем, очень сил...</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>очень сильной фиксации</td>\n",
       "      <td>Объем, очень сильная фиксация</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>Тафт 150 Уплотняющий спрей Густые и Пышные, св...</td>\n",
       "      <td>0.353553</td>\n",
       "      <td>очень сильной фиксации</td>\n",
       "      <td>и Пышные, сверхсильная фиксация</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>Тафт 150 Cпрей для волоc Power Экспресс-Укладк...</td>\n",
       "      <td>0.353553</td>\n",
       "      <td>очень сильной фиксации</td>\n",
       "      <td>Power Экспресс-Укладка мегафиксация</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Пена д/волос Тафт Объем д/тонких сверхсильная ...</td>\n",
       "      <td>Тафт 150 Пена для укладки волос Объем, мегафик...</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>д/тонких сверхсильная фиксация</td>\n",
       "      <td>волос Объем, мегафиксация</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Пена д/волос Тафт Объем д/тонких сверхсильная ...</td>\n",
       "      <td>Тафт 150 Пена Ultimate экстремальная фиксация</td>\n",
       "      <td>0.612372</td>\n",
       "      <td>д/тонких сверхсильная фиксация</td>\n",
       "      <td>фиксация</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>318</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа 250 Гель для душа Манго Дайкири</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>Манго Дайкири</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>319</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа MEN 250 Гель для душа Кофейный взрыв</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>душа Кофейный взрыв</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>320</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа MEN 250 Гель для душа Спорт</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>душа Спорт</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>321</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа MEN 250 Гель для душа Охлаждение Экстрим</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>душа Охлаждение Экстрим</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>322</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа 250 Гель для душа Ритмы Острова Бали Delight</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>Ритмы Острова Бали Delight</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>323 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                 Metro  \\\n",
       "0    Жидкость д/волос Тафт Объем очень сильной фикс...   \n",
       "1    Жидкость д/волос Тафт Объем очень сильной фикс...   \n",
       "2    Жидкость д/волос Тафт Объем очень сильной фикс...   \n",
       "3    Пена д/волос Тафт Объем д/тонких сверхсильная ...   \n",
       "4    Пена д/волос Тафт Объем д/тонких сверхсильная ...   \n",
       "..                                                 ...   \n",
       "318  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "319  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "320  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "321  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "322  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "\n",
       "                                                  Base  Cosine Similarity  \\\n",
       "0    Тафт 150 Жидкость для укладки Объем, очень сил...           0.707107   \n",
       "1    Тафт 150 Уплотняющий спрей Густые и Пышные, св...           0.353553   \n",
       "2    Тафт 150 Cпрей для волоc Power Экспресс-Укладк...           0.353553   \n",
       "3    Тафт 150 Пена для укладки волос Объем, мегафик...           0.707107   \n",
       "4        Тафт 150 Пена Ultimate экстремальная фиксация           0.612372   \n",
       "..                                                 ...                ...   \n",
       "318                 Фа 250 Гель для душа Манго Дайкири           0.471405   \n",
       "319            Фа MEN 250 Гель для душа Кофейный взрыв           0.471405   \n",
       "320                     Фа MEN 250 Гель для душа Спорт           0.471405   \n",
       "321        Фа MEN 250 Гель для душа Охлаждение Экстрим           0.471405   \n",
       "322    Фа 250 Гель для душа Ритмы Острова Бали Delight           0.471405   \n",
       "\n",
       "                          claim_len                           claim_base  \n",
       "0            очень сильной фиксации        Объем, очень сильная фиксация  \n",
       "1            очень сильной фиксации      и Пышные, сверхсильная фиксация  \n",
       "2            очень сильной фиксации  Power Экспресс-Укладка мегафиксация  \n",
       "3    д/тонких сверхсильная фиксация            волос Объем, мегафиксация  \n",
       "4    д/тонких сверхсильная фиксация                             фиксация  \n",
       "..                              ...                                  ...  \n",
       "318      муж Pure Revitalize Кактус                        Манго Дайкири  \n",
       "319      муж Pure Revitalize Кактус                  душа Кофейный взрыв  \n",
       "320      муж Pure Revitalize Кактус                           душа Спорт  \n",
       "321      муж Pure Revitalize Кактус              душа Охлаждение Экстрим  \n",
       "322      муж Pure Revitalize Кактус           Ритмы Острова Бали Delight  \n",
       "\n",
       "[323 rows x 5 columns]"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Создание нового датафрейма для результатов\n",
    "results = []\n",
    "\n",
    "# Итерация по каждой строке первого датафрейма\n",
    "\n",
    "for index, row in df.iterrows():\n",
    "    # Проверка значения в столбце subcategory\n",
    "    # Другие условия фильтрации\n",
    "\n",
    "    if row['Category'] == 'Deodoronts':\n",
    "        # Условия фильтрации для coloration\n",
    "        filtered_base = base[\n",
    "            (base[\"Категория\"] == row[\"Сategory\"]) &\n",
    "            (base['Бренд'] == row['Brand']) &\n",
    "            (base['Размер для названия'] == row['Size'])\n",
    "        ]\n",
    "    else:\n",
    "        # Другие условия фильтрации\n",
    "        filtered_base = base[\n",
    "            (base['Подкатегория'] == row['Subcategory']) &\n",
    "            (base['Бренд'] == row['Brand']) &\n",
    "            (base['Размер для названия'] == row['Size']) \n",
    "        ]\n",
    "    \n",
    "    if not filtered_base.empty:\n",
    "        # Векторизация текстов\n",
    "        series1 = [row['Product Name']]\n",
    "        series2 = filtered_base['Наименование']\n",
    "\n",
    "        vectorizer = TfidfVectorizer()\n",
    "        tfidf_matrix1 = vectorizer.fit_transform(series1)\n",
    "        tfidf_matrix2 = vectorizer.transform(series2)\n",
    "\n",
    "        # Вычисление косинусного сходства\n",
    "        cosine_similarities = cosine_similarity(tfidf_matrix1, tfidf_matrix2)\n",
    "\n",
    "        # Нахождение максимального индекса сходства\n",
    "        max_sim_index = cosine_similarities[0].argmax()\n",
    "        max_similarity = cosine_similarities[0][max_sim_index]\n",
    "\n",
    "        # Нахождение индексов трех наименований с максимальным сходством\n",
    "        top_indices = cosine_similarities[0].argsort()[::-1]  # последние 3 индекса, сортируем по убыванию\n",
    "\n",
    "        for idx in top_indices:  # выбираем только три наименования с максимальным сходством\n",
    "            results.append([\n",
    "                row['Product Name'], \n",
    "                filtered_base['Наименование'].iloc[idx], \n",
    "                cosine_similarities[0][idx], \n",
    "                row[\"claim_len\"],  # claim_len из df\n",
    "                filtered_base['claim_base'].iloc[idx]  # claim_base из filtered_base\n",
    "            ])\n",
    "\n",
    "# Создание итогового датафрейма\n",
    "result_df_super_full = pd.DataFrame(results, columns=['Metro', 'Base', 'Cosine Similarity', 'claim_len', 'claim_base'])\n",
    "result_df_super_full"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "bc28c1a8-b3fb-4da9-8a4d-7baf31478ac1",
   "metadata": {},
   "outputs": [],
   "source": [
    "result_df_super_full = result_df_super_full.dropna(subset = \"claim_base\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "38df7df6-d787-4c13-8963-b570c65c5788",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Metro</th>\n",
       "      <th>Base</th>\n",
       "      <th>Cosine Similarity</th>\n",
       "      <th>claim_len</th>\n",
       "      <th>claim_base</th>\n",
       "      <th>similarity</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>Тафт 150 Жидкость для укладки Объем, очень сил...</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>очень сильной фиксации</td>\n",
       "      <td>Объем, очень сильная фиксация</td>\n",
       "      <td>0.745098</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>Тафт 150 Уплотняющий спрей Густые и Пышные, св...</td>\n",
       "      <td>0.353553</td>\n",
       "      <td>очень сильной фиксации</td>\n",
       "      <td>и Пышные, сверхсильная фиксация</td>\n",
       "      <td>0.566038</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>Тафт 150 Cпрей для волоc Power Экспресс-Укладк...</td>\n",
       "      <td>0.353553</td>\n",
       "      <td>очень сильной фиксации</td>\n",
       "      <td>Power Экспресс-Укладка мегафиксация</td>\n",
       "      <td>0.315789</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Пена д/волос Тафт Объем д/тонких сверхсильная ...</td>\n",
       "      <td>Тафт 150 Пена для укладки волос Объем, мегафик...</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>д/тонких сверхсильная фиксация</td>\n",
       "      <td>волос Объем, мегафиксация</td>\n",
       "      <td>0.436364</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Пена д/волос Тафт Объем д/тонких сверхсильная ...</td>\n",
       "      <td>Тафт 150 Пена Ultimate экстремальная фиксация</td>\n",
       "      <td>0.612372</td>\n",
       "      <td>д/тонких сверхсильная фиксация</td>\n",
       "      <td>фиксация</td>\n",
       "      <td>0.421053</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>318</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа 250 Гель для душа Манго Дайкири</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>Манго Дайкири</td>\n",
       "      <td>0.153846</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>319</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа MEN 250 Гель для душа Кофейный взрыв</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>душа Кофейный взрыв</td>\n",
       "      <td>0.133333</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>320</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа MEN 250 Гель для душа Спорт</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>душа Спорт</td>\n",
       "      <td>0.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>321</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа MEN 250 Гель для душа Охлаждение Экстрим</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>душа Охлаждение Экстрим</td>\n",
       "      <td>0.040816</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>322</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа 250 Гель для душа Ритмы Острова Бали Delight</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>Ритмы Острова Бали Delight</td>\n",
       "      <td>0.192308</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>323 rows × 6 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                 Metro  \\\n",
       "0    Жидкость д/волос Тафт Объем очень сильной фикс...   \n",
       "1    Жидкость д/волос Тафт Объем очень сильной фикс...   \n",
       "2    Жидкость д/волос Тафт Объем очень сильной фикс...   \n",
       "3    Пена д/волос Тафт Объем д/тонких сверхсильная ...   \n",
       "4    Пена д/волос Тафт Объем д/тонких сверхсильная ...   \n",
       "..                                                 ...   \n",
       "318  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "319  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "320  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "321  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "322  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "\n",
       "                                                  Base  Cosine Similarity  \\\n",
       "0    Тафт 150 Жидкость для укладки Объем, очень сил...           0.707107   \n",
       "1    Тафт 150 Уплотняющий спрей Густые и Пышные, св...           0.353553   \n",
       "2    Тафт 150 Cпрей для волоc Power Экспресс-Укладк...           0.353553   \n",
       "3    Тафт 150 Пена для укладки волос Объем, мегафик...           0.707107   \n",
       "4        Тафт 150 Пена Ultimate экстремальная фиксация           0.612372   \n",
       "..                                                 ...                ...   \n",
       "318                 Фа 250 Гель для душа Манго Дайкири           0.471405   \n",
       "319            Фа MEN 250 Гель для душа Кофейный взрыв           0.471405   \n",
       "320                     Фа MEN 250 Гель для душа Спорт           0.471405   \n",
       "321        Фа MEN 250 Гель для душа Охлаждение Экстрим           0.471405   \n",
       "322    Фа 250 Гель для душа Ритмы Острова Бали Delight           0.471405   \n",
       "\n",
       "                          claim_len                           claim_base  \\\n",
       "0            очень сильной фиксации        Объем, очень сильная фиксация   \n",
       "1            очень сильной фиксации      и Пышные, сверхсильная фиксация   \n",
       "2            очень сильной фиксации  Power Экспресс-Укладка мегафиксация   \n",
       "3    д/тонких сверхсильная фиксация            волос Объем, мегафиксация   \n",
       "4    д/тонких сверхсильная фиксация                             фиксация   \n",
       "..                              ...                                  ...   \n",
       "318      муж Pure Revitalize Кактус                        Манго Дайкири   \n",
       "319      муж Pure Revitalize Кактус                  душа Кофейный взрыв   \n",
       "320      муж Pure Revitalize Кактус                           душа Спорт   \n",
       "321      муж Pure Revitalize Кактус              душа Охлаждение Экстрим   \n",
       "322      муж Pure Revitalize Кактус           Ритмы Острова Бали Delight   \n",
       "\n",
       "     similarity  \n",
       "0      0.745098  \n",
       "1      0.566038  \n",
       "2      0.315789  \n",
       "3      0.436364  \n",
       "4      0.421053  \n",
       "..          ...  \n",
       "318    0.153846  \n",
       "319    0.133333  \n",
       "320    0.166667  \n",
       "321    0.040816  \n",
       "322    0.192308  \n",
       "\n",
       "[323 rows x 6 columns]"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from difflib import SequenceMatcher\n",
    "\n",
    "# Предполагая, что result_df_super_full уже создан и содержит колонки 'claim_len' и 'claim_base'\n",
    "\n",
    "# Функция для расчета коэффициента схожести\n",
    "def calculate_similarity(a, b):\n",
    "    return SequenceMatcher(None, a, b).ratio()\n",
    "\n",
    "# Применяем функцию к каждой строке датафрейма\n",
    "result_df_super_full['similarity'] = result_df_super_full.apply(\n",
    "    lambda row: calculate_similarity(row['claim_len'], row['claim_base']), axis=1\n",
    ")\n",
    "result_df_super_full"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "62488688-6429-44d5-ac21-9483f3fa880f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Metro</th>\n",
       "      <th>Base</th>\n",
       "      <th>Cosine Similarity</th>\n",
       "      <th>claim_len</th>\n",
       "      <th>claim_base</th>\n",
       "      <th>similarity</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>Schw Gliss Термозащитное Масло Oil Nutritive 1...</td>\n",
       "      <td>Глисс Кур 150 Масло-уход</td>\n",
       "      <td>0.353553</td>\n",
       "      <td>Oil Nutritive</td>\n",
       "      <td>Масло-уход</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>84</th>\n",
       "      <td>Бальзам д/волос Глисс Кур Жидкий шелк д/непосл...</td>\n",
       "      <td>Глисс Кур 360 Бальзам Совершенство окрашенных ...</td>\n",
       "      <td>0.721688</td>\n",
       "      <td>Жидкий шелк д/непосл. тусклых волос</td>\n",
       "      <td>окрашенных волос</td>\n",
       "      <td>0.470588</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40</th>\n",
       "      <td>Гель д/волос Тафт Невид фиксац мега/ф 150мл</td>\n",
       "      <td>Тафт 150 Гель для волос Power Невидимая фиксация</td>\n",
       "      <td>0.654654</td>\n",
       "      <td>фиксац мега/ф</td>\n",
       "      <td>Power Невидимая фиксация</td>\n",
       "      <td>0.324324</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184</th>\n",
       "      <td>Гель д/д  Фа Feel Balance 250мл</td>\n",
       "      <td>Фа 250 Гель для душа Pure Organic Персик</td>\n",
       "      <td>0.632456</td>\n",
       "      <td>Balance</td>\n",
       "      <td>Pure Organic Персик</td>\n",
       "      <td>0.230769</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>Гель д/д  Фа Go Happy 250мл</td>\n",
       "      <td>Фа 250 Гель для душа Cream Oil Магнолия</td>\n",
       "      <td>0.632456</td>\n",
       "      <td>Happy</td>\n",
       "      <td>Cream Oil Магнолия</td>\n",
       "      <td>0.086957</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>46</th>\n",
       "      <td>Гель д/душа Schw Fa Active Спорт д/мужчин Гинк...</td>\n",
       "      <td>Фа MEN 750 Гель для душа Спорт</td>\n",
       "      <td>0.577350</td>\n",
       "      <td>Active Спорт д/мужчин Гинкго</td>\n",
       "      <td>душа Спорт</td>\n",
       "      <td>0.315789</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>303</th>\n",
       "      <td>Гель д/душа Schw Fa муж Pure Revitalize Кактус...</td>\n",
       "      <td>Фа 250 Гель для душа Pure Organic Персик</td>\n",
       "      <td>0.577350</td>\n",
       "      <td>муж Pure Revitalize Кактус</td>\n",
       "      <td>Pure Organic Персик</td>\n",
       "      <td>0.355556</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>74</th>\n",
       "      <td>Гель д/душа Фа Фиджи Dream 250мл</td>\n",
       "      <td>Фа 250 Гель для душа Cream Oil Магнолия</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>Dream</td>\n",
       "      <td>Cream Oil Магнолия</td>\n",
       "      <td>0.347826</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>94</th>\n",
       "      <td>Гель д/душа Фа муж Ночи Ипанемы 250мл</td>\n",
       "      <td>Фа 250 Гель для душа Ритмы Бразилии Ночи Ипанемы</td>\n",
       "      <td>0.845154</td>\n",
       "      <td>Ночи Ипанемы</td>\n",
       "      <td>Ритмы Бразилии Ночи Ипанемы</td>\n",
       "      <td>0.615385</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>245</th>\n",
       "      <td>Дез. Schw Fa муж. спрей Pure Protection Гуаран...</td>\n",
       "      <td>Фа MEN 150 Аэро. AP Pure Protection</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>спрей Pure Protection Гуарана</td>\n",
       "      <td>Pure Protection</td>\n",
       "      <td>0.681818</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>115</th>\n",
       "      <td>Дез. Schw Fa муж. спрей Тайна Амазонии 150мл</td>\n",
       "      <td>Фа MEN 150 Аэро. дезодорант  спрей для тела  С...</td>\n",
       "      <td>0.353553</td>\n",
       "      <td>спрей Тайна Амазонии</td>\n",
       "      <td>спрей для тела Сила Притяжения</td>\n",
       "      <td>0.440000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>241</th>\n",
       "      <td>Дезодорант жен Фа ролик Feel Balance 50мл</td>\n",
       "      <td>Фа 50 Роликовый дезодорант Ритмы Острова Бали ...</td>\n",
       "      <td>0.534522</td>\n",
       "      <td>Feel Balance</td>\n",
       "      <td>Острова Бали Delight</td>\n",
       "      <td>0.125000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>236</th>\n",
       "      <td>Дезодорант жен Фа ролик Go Happy 50мл</td>\n",
       "      <td>Фа 50 Роликовый дезодорант Ритмы Острова Бали ...</td>\n",
       "      <td>0.534522</td>\n",
       "      <td>Go Happy</td>\n",
       "      <td>Острова Бали Delight</td>\n",
       "      <td>0.071429</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>217</th>\n",
       "      <td>Дезодорант жен Фа спрей Feel Balance 150мл</td>\n",
       "      <td>Фа 150 Аэро. AP Создай Настроение Feel Balance</td>\n",
       "      <td>0.654654</td>\n",
       "      <td>Feel Balance</td>\n",
       "      <td>Настроение Feel Balance</td>\n",
       "      <td>0.685714</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>196</th>\n",
       "      <td>Дезодорант жен Фа спрей Go Happy 150мл</td>\n",
       "      <td>Фа 150 Аэро. AP Создай Настроение Go Happy</td>\n",
       "      <td>0.654654</td>\n",
       "      <td>Go Happy</td>\n",
       "      <td>Настроение Go Happy</td>\n",
       "      <td>0.592593</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146</th>\n",
       "      <td>Дезодорант жен Фа спрей Лайм/Кокос 150мл</td>\n",
       "      <td>Фа 150 Аэро. дез-антип Защита  Комфорт Аромат ...</td>\n",
       "      <td>0.377964</td>\n",
       "      <td>Лайм/Кокос</td>\n",
       "      <td>Комфорт Аромат Жасмина</td>\n",
       "      <td>0.250000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>284</th>\n",
       "      <td>Дезодорант жен Фа спрей Создай Настроение Заря...</td>\n",
       "      <td>Фа 150 Аэро. AP Создай Настроение Go Happy</td>\n",
       "      <td>0.577350</td>\n",
       "      <td>Создай Настроение Заряд позитива</td>\n",
       "      <td>Настроение Go Happy</td>\n",
       "      <td>0.470588</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>Дезодорант муж Фа MEN спрей антипресперант Про...</td>\n",
       "      <td>Фа MEN 150 Аэро. дез-антип Прозрачная защита</td>\n",
       "      <td>0.577350</td>\n",
       "      <td>спрей антипресперант Прозрачная защ</td>\n",
       "      <td>Прозрачная защита</td>\n",
       "      <td>0.538462</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Жидкость д/волос Тафт Объем очень сильной фикс...</td>\n",
       "      <td>Тафт 150 Жидкость для укладки Объем, очень сил...</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>очень сильной фиксации</td>\n",
       "      <td>Объем, очень сильная фиксация</td>\n",
       "      <td>0.745098</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>43</th>\n",
       "      <td>Лак д/волос Сьёсс Упругий Объем 400мл</td>\n",
       "      <td>СЬЁСС 400 Лак Для Волос Volume lift</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>Объем</td>\n",
       "      <td>Volume lift</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>154</th>\n",
       "      <td>Маска д/волос Шаума Энергия Природы Клубника/Б...</td>\n",
       "      <td>Шаума 380 Маска 3-в-1 Питательный Коктейль</td>\n",
       "      <td>0.500000</td>\n",
       "      <td>Природы Клубника/Банан</td>\n",
       "      <td>Коктейль</td>\n",
       "      <td>0.133333</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Пена д/волос Тафт Объем д/тонких сверхсильная ...</td>\n",
       "      <td>Тафт 150 Пена для укладки волос Объем, мегафик...</td>\n",
       "      <td>0.707107</td>\n",
       "      <td>д/тонких сверхсильная фиксация</td>\n",
       "      <td>волос Объем, мегафиксация</td>\n",
       "      <td>0.436364</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>92</th>\n",
       "      <td>Ш-нь Schw Schauma для девочек 350мл</td>\n",
       "      <td>Шаума Kids 350 Шампунь гель Нежный и бережный ...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>девочек</td>\n",
       "      <td>Нежный и бережный уход</td>\n",
       "      <td>0.068966</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>90</th>\n",
       "      <td>Ш-нь Schw Schauma для мальчиков 350мл</td>\n",
       "      <td>Шаума Kids 350 Шампунь гель Нежный и бережный ...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>мальчиков</td>\n",
       "      <td>Нежный и бережный уход</td>\n",
       "      <td>0.129032</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>Шампунь д/волос Глисс Кур Жидкий шелк д/непосл...</td>\n",
       "      <td>Глисс Кур 400 Шампунь Совершенство окрашенных ...</td>\n",
       "      <td>0.721688</td>\n",
       "      <td>Жидкий шелк д/непосл. тусклых волос</td>\n",
       "      <td>окрашенных волос</td>\n",
       "      <td>0.470588</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>270</th>\n",
       "      <td>Шампунь д/волос Шаума 7 трав 360мл</td>\n",
       "      <td>Шаума MEN 360 Шампунь Для мужчин Ультрасила</td>\n",
       "      <td>0.632456</td>\n",
       "      <td>Шаума трав</td>\n",
       "      <td>мужчин Ультрасила</td>\n",
       "      <td>0.370370</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>272</th>\n",
       "      <td>Шампунь д/волос муж Шаума Ultra Сила 650мл</td>\n",
       "      <td>Шаума MEN 650 Шампунь Для мужчин Ультрасила</td>\n",
       "      <td>0.534522</td>\n",
       "      <td>Ultra Сила</td>\n",
       "      <td>мужчин Ультрасила</td>\n",
       "      <td>0.296296</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>276</th>\n",
       "      <td>Шампунь д/волос, тела, лица муж Шаума Глубокое...</td>\n",
       "      <td>Шаума MEN 360 Шампунь Глубокое Очищение</td>\n",
       "      <td>0.632456</td>\n",
       "      <td>муж Шаума Глубокое Очищение в</td>\n",
       "      <td>Очищение</td>\n",
       "      <td>0.432432</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>Экспресс кондиционер д/волос Глисс Кур Oil Nut...</td>\n",
       "      <td>Глисс Кур 200 Крем-Преображение 10-в-1</td>\n",
       "      <td>0.471405</td>\n",
       "      <td>Кур Oil Nutritive п/сечения</td>\n",
       "      <td>Крем-Преображение -в-</td>\n",
       "      <td>0.250000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>63</th>\n",
       "      <td>Экспресс кондиционер д/волос Глисс Кур Безупре...</td>\n",
       "      <td>Глисс Кур 200 Маска в тубе Экстремальное восст...</td>\n",
       "      <td>0.500000</td>\n",
       "      <td>Кур Безупречно длинные</td>\n",
       "      <td>тубе Экстремальное восстановление</td>\n",
       "      <td>0.363636</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                 Metro  \\\n",
       "39   Schw Gliss Термозащитное Масло Oil Nutritive 1...   \n",
       "84   Бальзам д/волос Глисс Кур Жидкий шелк д/непосл...   \n",
       "40         Гель д/волос Тафт Невид фиксац мега/ф 150мл   \n",
       "184                    Гель д/д  Фа Feel Balance 250мл   \n",
       "165                        Гель д/д  Фа Go Happy 250мл   \n",
       "46   Гель д/душа Schw Fa Active Спорт д/мужчин Гинк...   \n",
       "303  Гель д/душа Schw Fa муж Pure Revitalize Кактус...   \n",
       "74                    Гель д/душа Фа Фиджи Dream 250мл   \n",
       "94               Гель д/душа Фа муж Ночи Ипанемы 250мл   \n",
       "245  Дез. Schw Fa муж. спрей Pure Protection Гуаран...   \n",
       "115       Дез. Schw Fa муж. спрей Тайна Амазонии 150мл   \n",
       "241          Дезодорант жен Фа ролик Feel Balance 50мл   \n",
       "236              Дезодорант жен Фа ролик Go Happy 50мл   \n",
       "217         Дезодорант жен Фа спрей Feel Balance 150мл   \n",
       "196             Дезодорант жен Фа спрей Go Happy 150мл   \n",
       "146           Дезодорант жен Фа спрей Лайм/Кокос 150мл   \n",
       "284  Дезодорант жен Фа спрей Создай Настроение Заря...   \n",
       "21   Дезодорант муж Фа MEN спрей антипресперант Про...   \n",
       "0    Жидкость д/волос Тафт Объем очень сильной фикс...   \n",
       "43               Лак д/волос Сьёсс Упругий Объем 400мл   \n",
       "154  Маска д/волос Шаума Энергия Природы Клубника/Б...   \n",
       "3    Пена д/волос Тафт Объем д/тонких сверхсильная ...   \n",
       "92                 Ш-нь Schw Schauma для девочек 350мл   \n",
       "90               Ш-нь Schw Schauma для мальчиков 350мл   \n",
       "13   Шампунь д/волос Глисс Кур Жидкий шелк д/непосл...   \n",
       "270                 Шампунь д/волос Шаума 7 трав 360мл   \n",
       "272         Шампунь д/волос муж Шаума Ultra Сила 650мл   \n",
       "276  Шампунь д/волос, тела, лица муж Шаума Глубокое...   \n",
       "10   Экспресс кондиционер д/волос Глисс Кур Oil Nut...   \n",
       "63   Экспресс кондиционер д/волос Глисс Кур Безупре...   \n",
       "\n",
       "                                                  Base  Cosine Similarity  \\\n",
       "39                            Глисс Кур 150 Масло-уход           0.353553   \n",
       "84   Глисс Кур 360 Бальзам Совершенство окрашенных ...           0.721688   \n",
       "40    Тафт 150 Гель для волос Power Невидимая фиксация           0.654654   \n",
       "184           Фа 250 Гель для душа Pure Organic Персик           0.632456   \n",
       "165            Фа 250 Гель для душа Cream Oil Магнолия           0.632456   \n",
       "46                      Фа MEN 750 Гель для душа Спорт           0.577350   \n",
       "303           Фа 250 Гель для душа Pure Organic Персик           0.577350   \n",
       "74             Фа 250 Гель для душа Cream Oil Магнолия           0.707107   \n",
       "94    Фа 250 Гель для душа Ритмы Бразилии Ночи Ипанемы           0.845154   \n",
       "245                Фа MEN 150 Аэро. AP Pure Protection           0.471405   \n",
       "115  Фа MEN 150 Аэро. дезодорант  спрей для тела  С...           0.353553   \n",
       "241  Фа 50 Роликовый дезодорант Ритмы Острова Бали ...           0.534522   \n",
       "236  Фа 50 Роликовый дезодорант Ритмы Острова Бали ...           0.534522   \n",
       "217     Фа 150 Аэро. AP Создай Настроение Feel Balance           0.654654   \n",
       "196         Фа 150 Аэро. AP Создай Настроение Go Happy           0.654654   \n",
       "146  Фа 150 Аэро. дез-антип Защита  Комфорт Аромат ...           0.377964   \n",
       "284         Фа 150 Аэро. AP Создай Настроение Go Happy           0.577350   \n",
       "21        Фа MEN 150 Аэро. дез-антип Прозрачная защита           0.577350   \n",
       "0    Тафт 150 Жидкость для укладки Объем, очень сил...           0.707107   \n",
       "43                 СЬЁСС 400 Лак Для Волос Volume lift           0.707107   \n",
       "154         Шаума 380 Маска 3-в-1 Питательный Коктейль           0.500000   \n",
       "3    Тафт 150 Пена для укладки волос Объем, мегафик...           0.707107   \n",
       "92   Шаума Kids 350 Шампунь гель Нежный и бережный ...           0.000000   \n",
       "90   Шаума Kids 350 Шампунь гель Нежный и бережный ...           0.000000   \n",
       "13   Глисс Кур 400 Шампунь Совершенство окрашенных ...           0.721688   \n",
       "270        Шаума MEN 360 Шампунь Для мужчин Ультрасила           0.632456   \n",
       "272        Шаума MEN 650 Шампунь Для мужчин Ультрасила           0.534522   \n",
       "276            Шаума MEN 360 Шампунь Глубокое Очищение           0.632456   \n",
       "10              Глисс Кур 200 Крем-Преображение 10-в-1           0.471405   \n",
       "63   Глисс Кур 200 Маска в тубе Экстремальное восст...           0.500000   \n",
       "\n",
       "                               claim_len                         claim_base  \\\n",
       "39                         Oil Nutritive                         Масло-уход   \n",
       "84   Жидкий шелк д/непосл. тусклых волос                   окрашенных волос   \n",
       "40                         фиксац мега/ф           Power Невидимая фиксация   \n",
       "184                              Balance                Pure Organic Персик   \n",
       "165                                Happy                 Cream Oil Магнолия   \n",
       "46          Active Спорт д/мужчин Гинкго                         душа Спорт   \n",
       "303           муж Pure Revitalize Кактус                Pure Organic Персик   \n",
       "74                                 Dream                 Cream Oil Магнолия   \n",
       "94                          Ночи Ипанемы        Ритмы Бразилии Ночи Ипанемы   \n",
       "245        спрей Pure Protection Гуарана                    Pure Protection   \n",
       "115                 спрей Тайна Амазонии     спрей для тела Сила Притяжения   \n",
       "241                         Feel Balance               Острова Бали Delight   \n",
       "236                             Go Happy               Острова Бали Delight   \n",
       "217                         Feel Balance            Настроение Feel Balance   \n",
       "196                             Go Happy                Настроение Go Happy   \n",
       "146                           Лайм/Кокос             Комфорт Аромат Жасмина   \n",
       "284     Создай Настроение Заряд позитива                Настроение Go Happy   \n",
       "21   спрей антипресперант Прозрачная защ                  Прозрачная защита   \n",
       "0                 очень сильной фиксации      Объем, очень сильная фиксация   \n",
       "43                                 Объем                        Volume lift   \n",
       "154               Природы Клубника/Банан                           Коктейль   \n",
       "3         д/тонких сверхсильная фиксация          волос Объем, мегафиксация   \n",
       "92                               девочек             Нежный и бережный уход   \n",
       "90                             мальчиков             Нежный и бережный уход   \n",
       "13   Жидкий шелк д/непосл. тусклых волос                   окрашенных волос   \n",
       "270                           Шаума трав                  мужчин Ультрасила   \n",
       "272                           Ultra Сила                  мужчин Ультрасила   \n",
       "276        муж Шаума Глубокое Очищение в                           Очищение   \n",
       "10           Кур Oil Nutritive п/сечения              Крем-Преображение -в-   \n",
       "63                Кур Безупречно длинные  тубе Экстремальное восстановление   \n",
       "\n",
       "     similarity  \n",
       "39     0.000000  \n",
       "84     0.470588  \n",
       "40     0.324324  \n",
       "184    0.230769  \n",
       "165    0.086957  \n",
       "46     0.315789  \n",
       "303    0.355556  \n",
       "74     0.347826  \n",
       "94     0.615385  \n",
       "245    0.681818  \n",
       "115    0.440000  \n",
       "241    0.125000  \n",
       "236    0.071429  \n",
       "217    0.685714  \n",
       "196    0.592593  \n",
       "146    0.250000  \n",
       "284    0.470588  \n",
       "21     0.538462  \n",
       "0      0.745098  \n",
       "43     0.000000  \n",
       "154    0.133333  \n",
       "3      0.436364  \n",
       "92     0.068966  \n",
       "90     0.129032  \n",
       "13     0.470588  \n",
       "270    0.370370  \n",
       "272    0.296296  \n",
       "276    0.432432  \n",
       "10     0.250000  \n",
       "63     0.363636  "
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Группируем по 'metro' и находим индекс строки с максимальным значением 'similarity'\n",
    "idx = result_df_super_full.groupby('Metro')['similarity'].idxmax()\n",
    "\n",
    "# Используем полученные индексы для фильтрации датафрейма\n",
    "result_df_max_similarity = result_df_super_full.loc[idx]\n",
    "\n",
    "result_df_max_similarity"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "da518e9e-d4a2-418a-83f5-9afb2dab1737",
   "metadata": {},
   "outputs": [],
   "source": [
    "result_df_max_similarity.to_excel(\"something globus shower.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f69bb3e8-d6d6-4ed7-a845-1dcab4f22d26",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "67228d8b-aca2-4925-bb4c-0b245f4d6877",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
